@page "/warehouse/cycle-counts"

<PageHeader Title="@Context.EntityNamePlural" />

<EntityTable @ref="_table" TEntity="CycleCountResponse" TId="DefaultIdType" TRequest="CycleCountViewModel" Context="@Context">
    <ExtraActions Context="context">
        <MudMenuItem OnClick="@(() => ViewCycleCountDetails(context.Id))">
            <MudIcon Icon="@Icons.Material.Filled.Visibility" Size="Size.Small" /> View Details
        </MudMenuItem>
        <MudMenuItem OnClick="@(() => StartCycleCount(context.Id))">
            <MudIcon Icon="@Icons.Material.Filled.PlayArrow" Size="Size.Small" /> Start
        </MudMenuItem>
        <MudMenuItem OnClick="@(() => CompleteCycleCount(context.Id))">
            <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Size="Size.Small" /> Complete
        </MudMenuItem>
        <MudMenuItem OnClick="@(() => ReconcileCycleCount(context.Id))">
            <MudIcon Icon="@Icons.Material.Filled.Sync" Size="Size.Small" /> Reconcile
        </MudMenuItem>
        <MudMenuItem OnClick="@(() => CancelCycleCount(context.Id))">
            <MudIcon Icon="@Icons.Material.Filled.Cancel" Size="Size.Small" /> Cancel
        </MudMenuItem>
    </ExtraActions>
    <EditFormContent Context="context">
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudTextField @bind-Value="context.CountNumber" For="@(() => context.CountNumber)" Label="Count Number" Required />
        </MudItem>
        
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudAutocomplete T="DefaultIdType" @bind-Value="context.WarehouseId" For="@(() => context.WarehouseId)"
                             Label="Warehouse" Required
                             SearchFunc="@SearchWarehouses"
                             ToStringFunc="@(id => _warehouses.FirstOrDefault(w => w.Id == id)?.Name ?? string.Empty)" />
        </MudItem>
        
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudAutocomplete T="DefaultIdType?" @bind-Value="context.WarehouseLocationId" For="@(() => context.WarehouseLocationId)"
                             Label="Warehouse Location (Optional)"
                             SearchFunc="@SearchWarehouseLocations"
                             ToStringFunc="@(id => id.HasValue ? _warehouseLocations.FirstOrDefault(l => l.Id == id)?.Name ?? string.Empty : string.Empty)" />
        </MudItem>
        
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudDatePicker @bind-Date="context.ScheduledDate" For="@(() => context.ScheduledDate)" Label="Scheduled Date" DateFormat="MMMM dd, yyyy" Required />
        </MudItem>
        
        <MudItem xs="12" sm="6" md="4" lg="3">
            <AutocompleteCountType @bind-Value="context.CountType"
                                  For="@(() => context.CountType!)"
                                  Label="Count Type"
                                  Variant="Variant.Filled" />
        </MudItem>
        
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudTextField @bind-Value="context.CounterName" For="@(() => context.CounterName)" Label="Counter Name" />
        </MudItem>
        
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudTextField @bind-Value="context.SupervisorName" For="@(() => context.SupervisorName)" Label="Supervisor Name" />
        </MudItem>
        
        <MudItem xs="12">
            <MudTextField @bind-Value="context.Notes" For="@(() => context.Notes)" Label="Notes" Lines="3" />
        </MudItem>
    </EditFormContent>
</EntityTable>

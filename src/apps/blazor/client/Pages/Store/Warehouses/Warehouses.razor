@page "/store/warehouses"

<PageHeader Title="Warehouse Management" 
            Header="Warehouse Management" 
            SubHeader="Manage warehouses, locations, and storage facilities." />

<MudPaper Elevation="@_preference.Elevation" Class="pa-4 mb-4">
    <MudStack Row="true" Spacing="2" Wrap="Wrap.Wrap">
        <MudButtonGroup Color="Color.Primary" Variant="Variant.Outlined" Size="Size.Small">
            <MudButton StartIcon="@Icons.Material.Filled.Warehouse" OnClick="@(() => StateHasChanged())">
                All Warehouses
            </MudButton>
            <MudButton StartIcon="@Icons.Material.Filled.Store" OnClick="@(() => { SearchIsMainWarehouse = true; StateHasChanged(); })">
                Main Warehouses
            </MudButton>
        </MudButtonGroup>

        <MudButtonGroup Color="Color.Secondary" Variant="Variant.Outlined" Size="Size.Small">
            <MudButton StartIcon="@Icons.Material.Filled.CheckCircle" OnClick="@(() => { SearchIsActive = true; StateHasChanged(); })">
                Active
            </MudButton>
            <MudButton StartIcon="@Icons.Material.Filled.Cancel" OnClick="@(() => { SearchIsActive = false; StateHasChanged(); })">
                Inactive
            </MudButton>
        </MudButtonGroup>

        <MudButtonGroup Color="Color.Info" Variant="Variant.Outlined" Size="Size.Small">
            <MudButton StartIcon="@Icons.Material.Filled.FileDownload">
                Export
            </MudButton>
            <MudButton StartIcon="@Icons.Material.Filled.Settings">
                Settings
            </MudButton>
        </MudButtonGroup>
        <MudSpacer />
        <MudButtonGroup Color="Color.Info" Variant="Variant.Outlined" Size="Size.Small">
            <MudButton StartIcon="@Icons.Material.Filled.Help" OnClick="@ShowWarehousesHelp">
                Help
            </MudButton>
        </MudButtonGroup>
    </MudStack>
</MudPaper>

<EntityTable @ref="_table" 
             TEntity="WarehouseResponse" 
             TId="DefaultIdType" 
             TRequest="WarehouseViewModel" 
             Context="@Context">

    <ExtraActions Context="context">
        <MudMenuItem OnClick="@(() => AssignManager(context.Id))"
                     Icon="@Icons.Material.Filled.PersonAdd">
                Assign Manager
        </MudMenuItem>
    </ExtraActions>

    <EditFormContent Context="context">
        @if (!Context.AddEditModal.IsCreate)
        {
            <MudItem xs="12" sm="6" md="4" lg="3">
                <MudTextField Value="context.Id" Underline=false ReadOnly Label="Warehouse Id" />
            </MudItem>
        }

        @* Basic Information *@
        <MudDivider/>
        <MudItem xs="12" sm="6" md="3" lg="2">
            <MudTextField Label="Code" 
                          For="@(() => context.Code)" 
                          @bind-Value="context.Code" 
                          Required="true"
                          Placeholder="WH001" />
        </MudItem>

        <MudItem xs="12" sm="6" md="9" lg="10">
            <MudTextField Label="Name" 
                          For="@(() => context.Name)" 
                          @bind-Value="context.Name" 
                          Required="true"
                          Placeholder="Main Warehouse" />
        </MudItem>

        <MudItem xs="12">
            <MudTextField Label="Address" 
                          For="@(() => context.Address)" 
                          @bind-Value="context.Address" 
                          Required="true"
                          Placeholder="123 Storage Street, New York, NY 10001, USA" />
        </MudItem>

        <MudItem xs="12">
            <MudTextField Label="Description" 
                          For="@(() => context.Description)" 
                          @bind-Value="context.Description"
                          Placeholder="Primary storage facility" />
        </MudItem>
        
        <MudDivider Class="my-4" DividerType="DividerType.Middle" />
        <MudItem xs="12">
            <MudText Typo="Typo.subtitle2">Manager Information</MudText>
        </MudItem>

        @* Manager Information *@
        <MudItem xs="12" sm="6">
            <MudTextField Label="Manager Name" 
                          For="@(() => context.ManagerName)" 
                          @bind-Value="context.ManagerName" 
                          Required="true"
                          Placeholder="John Manager"
                          Adornment="Adornment.Start"
                          AdornmentIcon="@Icons.Material.Filled.Person" />
        </MudItem>

        <MudItem xs="12" sm="6">
            <MudTextField Label="Manager Email" 
                          For="@(() => context.ManagerEmail)" 
                          @bind-Value="context.ManagerEmail" 
                          Required="true"
                          Placeholder="john.manager@example.com"
                          InputType="InputType.Email"
                          Adornment="Adornment.Start"
                          AdornmentIcon="@Icons.Material.Filled.Email" />
        </MudItem>

        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudTextField Label="Manager Phone" 
                          For="@(() => context.ManagerPhone)" 
                          @bind-Value="context.ManagerPhone" 
                          Required="true"
                          Placeholder="+1-555-123-4567"
                          InputType="InputType.Telephone"
                          Adornment="Adornment.Start"
                          AdornmentIcon="@Icons.Material.Filled.Phone" />
        </MudItem>

        <MudDivider Class="my-4" DividerType="DividerType.Middle" />
        <MudItem xs="12">
            <MudText Typo="Typo.subtitle2">Capacity Information</MudText>
        </MudItem>
        
        @* Capacity Information *@
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudNumericField T="decimal" 
                             @bind-Value="context.TotalCapacity" 
                             For="@(() => context.TotalCapacity)" 
                             Format="N2"
                             Label="Total Capacity" 
                             Immediate="true" 
                             Required
                             Min="0"
                             Adornment="Adornment.End"
                             AdornmentText="@context.CapacityUnit" />
        </MudItem>

        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudTextField Label="Capacity Unit" 
                          For="@(() => context.CapacityUnit)" 
                          @bind-Value="context.CapacityUnit" 
                          Required="true"
                          Placeholder="sqft" />
        </MudItem>

        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudSelect T="string"
                       @bind-Value="context.WarehouseType"
                       For="@(() => context.WarehouseType)"
                       Label="Warehouse Type"
                       Placeholder="Select a warehouse type"
                       AnchorOrigin="Origin.BottomCenter"
                       TransformOrigin="Origin.TopCenter"
                       Required="true">
                @foreach (var warehouseType in WarehouseTypeConstants.WarehouseTypes)
                {
                    <MudSelectItem Value="@warehouseType">@warehouseType</MudSelectItem>
                }
            </MudSelect>
        </MudItem>

        <MudDivider Class="my-4" DividerType="DividerType.Middle" />
        <MudItem xs="12">
            <MudText Typo="Typo.subtitle2">Status & Settings</MudText>
        </MudItem>

        @* Status Switches *@
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudSwitch Class="mt-3" 
                       T="bool" 
                       @bind-Value="context.IsActive" 
                       Color="Color.Success">
                Active
            </MudSwitch>
        </MudItem>

        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudSwitch Class="mt-3" 
                       T="bool" 
                       @bind-Value="context.IsMainWarehouse" 
                       Color="Color.Primary">
                Main Warehouse
            </MudSwitch>
        </MudItem>

        <MudDivider Class="my-4" DividerType="DividerType.Middle" />
        <MudItem xs="12">
            <MudText Typo="Typo.subtitle2">Other Information</MudText>
        </MudItem>

        @* Notes *@
        <MudItem xs="12">
            <MudTextField Label="Notes" 
                          For="@(() => context.Notes)" 
                          @bind-Value="context.Notes"
                          Lines="3"
                          Placeholder="Additional notes or comments..." />
        </MudItem>
    </EditFormContent>
</EntityTable>


@page "/store/inventory-transfers"

<PageHeader Title="Inventory Transfers" Header="Inventory Transfers" SubHeader="Manage inventory transfers between warehouses." />

<MudPaper Elevation="2" Class="pa-4 mb-4">
    <MudStack Row="true" Spacing="2" Wrap="Wrap.Wrap" AlignItems="AlignItems.Center">
        <MudSpacer />
        <MudButtonGroup Color="Color.Info" Variant="Variant.Outlined" Size="Size.Small">
            <MudButton StartIcon="@Icons.Material.Filled.Help" OnClick="@ShowInventoryTransfersHelp">
                Help
            </MudButton>
        </MudButtonGroup>
    </MudStack>
</MudPaper>

<EntityTable @ref="_table" TEntity="GetInventoryTransferListResponse" TId="DefaultIdType" TRequest="InventoryTransferViewModel" Context="@Context">
    <ExtraActions Context="context">
        @if (context.Status == "Draft")
        {
            <MudMenuItem OnClick="@(() => ApproveTransfer(context.Id))">
                <div class="d-flex align-center">
                    <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Class="mr-2" />
                    <span>Approve Transfer</span>
                </div>
            </MudMenuItem>
        }
        @if (context.Status == "Approved")
        {
            <MudMenuItem OnClick="@(() => MarkInTransit(context.Id))">
                <div class="d-flex align-center">
                    <MudIcon Icon="@Icons.Material.Filled.LocalShipping" Class="mr-2" />
                    <span>Mark In Transit</span>
                </div>
            </MudMenuItem>
        }
        @if (context.Status == "InTransit")
        {
            <MudMenuItem OnClick="@(() => CompleteTransfer(context.Id))">
                <div class="d-flex align-center">
                    <MudIcon Icon="@Icons.Material.Filled.Done" Class="mr-2" />
                    <span>Complete Transfer</span>
                </div>
            </MudMenuItem>
        }
        @if (context.Status is "Draft" or "Approved")
        {
            <MudMenuItem OnClick="@(() => CancelTransfer(context.Id))">
                <div class="d-flex align-center">
                    <MudIcon Icon="@Icons.Material.Filled.Cancel" Class="mr-2" Color="Color.Error" />
                    <span>Cancel Transfer</span>
                </div>
            </MudMenuItem>
        }
    </ExtraActions>

    <EditFormContent Context="context">
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudTextField @bind-Value="context.Name" For="@(() => context.Name)" Label="Name" Required="true" />
        </MudItem>
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudTextField @bind-Value="context.TransferNumber" For="@(() => context.TransferNumber)" Label="Transfer Number" />
        </MudItem>
        <MudItem xs="12">
            <MudTextField @bind-Value="context.Description" For="@(() => context.Description)" Label="Description" Lines="2" />
        </MudItem>
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudSelect @bind-Value="context.TransferType" For="@(() => context.TransferType)" Label="Transfer Type" Required="true">
                <MudSelectItem Value="@("Standard")">Standard</MudSelectItem>
                <MudSelectItem Value="@("Emergency")">Emergency</MudSelectItem>
                <MudSelectItem Value="@("Replenishment")">Replenishment</MudSelectItem>
                <MudSelectItem Value="@("Return")">Return</MudSelectItem>
            </MudSelect>
        </MudItem>
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudSelect @bind-Value="context.Status" For="@(() => context.Status)" Label="Status" Required="true">
                <MudSelectItem Value="@("Pending")">Pending</MudSelectItem>
                <MudSelectItem Value="@("Draft")">Draft</MudSelectItem>
                <MudSelectItem Value="@("Approved")">Approved</MudSelectItem>
                <MudSelectItem Value="@("InTransit")">In Transit</MudSelectItem>
                <MudSelectItem Value="@("Completed")">Completed</MudSelectItem>
                <MudSelectItem Value="@("Cancelled")">Cancelled</MudSelectItem>
            </MudSelect>
        </MudItem>
        <MudItem xs="12" sm="6" md="4" lg="3">
            <AutocompleteWarehouse @bind-Value="context.FromWarehouseId" For="@(() => context.FromWarehouseId)" Label="From Warehouse" Required="true" />
        </MudItem>
        <MudItem xs="12" sm="6" md="4" lg="3">
            <AutocompleteWarehouse @bind-Value="context.ToWarehouseId" For="@(() => context.ToWarehouseId)" Label="To Warehouse" Required="true" />
        </MudItem>
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudDatePicker @bind-Date="context.TransferDate" For="@(() => context.TransferDate)" Label="Transfer Date" DateFormat="MMMM dd, yyyy" Required="true" />
        </MudItem>
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudDatePicker @bind-Date="context.ExpectedArrivalDate" For="@(() => context.ExpectedArrivalDate)" Label="Expected Arrival Date" DateFormat="MMMM dd, yyyy" />
        </MudItem>
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudSelect @bind-Value="context.Priority" For="@(() => context.Priority)" Label="Priority">
                <MudSelectItem Value="@("Low")">Low</MudSelectItem>
                <MudSelectItem Value="@("Normal")">Normal</MudSelectItem>
                <MudSelectItem Value="@("High")">High</MudSelectItem>
                <MudSelectItem Value="@("Urgent")">Urgent</MudSelectItem>
            </MudSelect>
        </MudItem>
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudTextField @bind-Value="context.TransportMethod" For="@(() => context.TransportMethod)" Label="Transport Method" />
        </MudItem>
        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudTextField @bind-Value="context.TrackingNumber" For="@(() => context.TrackingNumber)" Label="Tracking Number" />
        </MudItem>
        <MudItem xs="12">
            <MudTextField @bind-Value="context.Reason" For="@(() => context.Reason)" Label="Reason" Required="true" />
        </MudItem>
        <MudItem xs="12">
            <MudTextField @bind-Value="context.Notes" For="@(() => context.Notes)" Label="Notes" Lines="3" />
        </MudItem>
    </EditFormContent>
</EntityTable>

@page "/store/dashboard"

<PageHeader Title="Store Dashboard" Header="Warehouse & Inventory Management" SubHeader="Real-time insights into your store operations" />

@if (_loading)
{
    <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="mt-4" />
}
else
{
    <MudContainer MaxWidth="MaxWidth.False" Class="mt-4">
        <!-- Top KPI Row -->
        <MudGrid GutterSize="3" Class="mb-4">
            <MudItem xs="12" sm="6" lg="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <div class="d-flex justify-space-between align-center">
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-1" Style="color: rgba(255,255,255,0.9);">Total Items</MudText>
                            <MudText Typo="Typo.h4" Style="font-weight: 600; color: white;">@_metrics.TotalItems.ToString("N0")</MudText>
                            <MudText Typo="Typo.caption" Class="mt-1" Style="color: rgba(255,255,255,0.8);">
                                <MudIcon Icon="@Icons.Material.Filled.Inventory" Size="Size.Small" Class="mr-1" Style="color: rgba(255,255,255,0.8);" />
                                Active inventory items
                            </MudText>
                        </div>
                        <MudAvatar Size="Size.Large" Style="background: var(--mud-palette-action-default-hover);">
                            <MudIcon Icon="@Icons.Material.Filled.ShoppingCart" Size="Size.Medium" Style="color: white;" />
                        </MudAvatar>
                    </div>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" lg="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                    <div class="d-flex justify-space-between align-center">
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-1" Style="color: rgba(255,255,255,0.9);">POs Completed</MudText>
                            <MudText Typo="Typo.h4" Style="font-weight: 600; color: white;">@_metrics.PurchaseOrdersCompleted.ToString("N0")</MudText>
                            <MudText Typo="Typo.caption" Class="mt-1" Style="color: rgba(255,255,255,0.8);">
                                <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Size="Size.Small" Class="mr-1" Style="color: rgba(255,255,255,0.8);" />
                                Received purchase orders
                            </MudText>
                        </div>
                        <MudAvatar Size="Size.Large" Style="background: var(--mud-palette-action-default-hover);">
                            <MudIcon Icon="@Icons.Material.Filled.DoneAll" Size="Size.Medium" Style="color: white;" />
                        </MudAvatar>
                    </div>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" lg="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                    <div class="d-flex justify-space-between align-center">
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-1" Style="color: rgba(255,255,255,0.9);">Low Stock Items</MudText>
                            <MudText Typo="Typo.h4" Style="font-weight: 600; color: white;">@_metrics.LowStockItems.ToString("N0")</MudText>
                            <MudText Typo="Typo.caption" Class="mt-1" Style="color: rgba(255,255,255,0.8);">
                                <MudIcon Icon="@Icons.Material.Filled.Warning" Size="Size.Small" Class="mr-1" Style="color: rgba(255,255,255,0.8);" />
                                Below reorder point
                            </MudText>
                        </div>
                        <MudAvatar Size="Size.Large" Style="background: var(--mud-palette-action-default-hover);">
                            <MudIcon Icon="@Icons.Material.Filled.TrendingDown" Size="Size.Medium" Style="color: white;" />
                        </MudAvatar>
                    </div>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" lg="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;">
                    <div class="d-flex justify-space-between align-center">
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-1" Style="color: rgba(255,255,255,0.9);">POs Pending</MudText>
                            <MudText Typo="Typo.h4" Style="font-weight: 600; color: white;">@_metrics.PurchaseOrdersPending.ToString("N0")</MudText>
                            <MudText Typo="Typo.caption" Class="mt-1" Style="color: rgba(255,255,255,0.8);">
                                <MudIcon Icon="@Icons.Material.Filled.HourglassEmpty" Size="Size.Small" Class="mr-1" Style="color: rgba(255,255,255,0.8);" />
                                Awaiting approval/action
                            </MudText>
                        </div>
                        <MudAvatar Size="Size.Large" Style="background: var(--mud-palette-action-default-hover);">
                            <MudIcon Icon="@Icons.Material.Filled.Schedule" Size="Size.Medium" Style="color: white;" />
                        </MudAvatar>
                    </div>
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- Secondary KPI Row -->
        <MudGrid GutterSize="3" Class="mb-4">
            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-3">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Warehouse" Color="Color.Info" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">Warehouses</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.WarehousesCount</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Active locations</MudText>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-3">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Business" Color="Color.Success" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">Suppliers</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.SuppliersCount</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Registered vendors</MudText>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-3">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.LocalShipping" Color="Color.Warning" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">POs Approved</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.PurchaseOrdersApproved</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Awaiting delivery</MudText>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-3">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Cancel" Color="Color.Error" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">POs Cancelled</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.PurchaseOrdersCancelled</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Cancelled orders</MudText>
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- Tertiary KPI Row - Warehouse Operations -->
        <MudGrid GutterSize="3" Class="mb-4">
            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-3">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Inbox" Color="Color.Primary" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">Goods Receipts</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.GoodsReceiptsCount</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Total received</MudText>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-3">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.CompareArrows" Color="Color.Tertiary" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">Transfers Pending</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.InventoryTransfersPending</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">In-transit items</MudText>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-3">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Assignment" Color="Color.Info" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">Active Pick Lists</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.ActivePickLists</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">In progress</MudText>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-3">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Summarize" Color="Color.Secondary" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">Cycle Counts</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.CycleCountsInProgress</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Active counts</MudText>
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- New Features KPI Row - Sales Imports & Stock Movements -->
        <MudGrid GutterSize="3" Class="mb-4">
            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-3" Style="border-left: 4px solid var(--mud-palette-primary);">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Upload" Color="Color.Primary" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">Sales Imports</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.SalesImportsCount</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">
                        @_metrics.SalesImportsUnprocessed unprocessed
                    </MudText>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-3" Style="border-left: 4px solid var(--mud-palette-success);">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.ShoppingBag" Color="Color.Success" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">Total Sold</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.TotalQuantitySold.ToString("N0")</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Units from imports</MudText>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-3" Style="border-left: 4px solid var(--mud-palette-warning);">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Adjust" Color="Color.Warning" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">Stock Adjustments</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.StockAdjustmentsCount</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">This month</MudText>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="@_preference.Elevation" Class="pa-3" Style="border-left: 4px solid var(--mud-palette-tertiary);">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Category" Color="Color.Tertiary" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">Categories</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.TotalCategories</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Item classifications</MudText>
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- Main Content Row -->
        <MudGrid GutterSize="3">
            <!-- Purchase Order Status (Donut Chart) -->
            <MudItem xs="12" md="5">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="height: 450px;">
                    <MudText Typo="Typo.h6" Style="font-weight: 600;" Class="mb-3" Color="Color.Default">Purchase Order Status</MudText>
                    <div style="height: 250px;" class="d-flex justify-center align-center">
                        @if (_charts.OrderSourceDatasets.Count > 0 && _charts.OrderSourceDatasets.First().Data.Any())
                        {
                            <MudChart ChartType="ChartType.Donut" 
                                      InputData="@_charts.OrderSourceDatasets.First().Data.Select(d => d).ToArray()" 
                                      InputLabels="@_charts.OrderSourceLabels"
                                      Width="250px" Height="250px" />
                        }
                        else
                        {
                            <MudText Typo="Typo.body2" Color="Color.Secondary">No purchase orders yet</MudText>
                        }
                    </div>
                    <div class="mt-4">
                        <div class="d-flex justify-space-between align-center mb-2">
                            <div class="d-flex align-center">
                                <div style="width: 12px; height: 12px; background: var(--mud-palette-success); border-radius: 50%; margin-right: 8px;"></div>
                                <MudText Typo="Typo.body2" Color="Color.Default">Pending</MudText>
                            </div>
                            <MudText Typo="Typo.body2" Style="font-weight: 600;" Color="Color.Default">@_metrics.PurchaseOrdersPending</MudText>
                        </div>
                        <div class="d-flex justify-space-between align-center mb-2">
                            <div class="d-flex align-center">
                                <div style="width: 12px; height: 12px; background: var(--mud-palette-info); border-radius: 50%; margin-right: 8px;"></div>
                                <MudText Typo="Typo.body2" Color="Color.Default">Approved/Sent</MudText>
                            </div>
                            <MudText Typo="Typo.body2" Style="font-weight: 600;" Color="Color.Default">@_metrics.PurchaseOrdersApproved</MudText>
                        </div>
                        <div class="d-flex justify-space-between align-center mb-2">
                            <div class="d-flex align-center">
                                <div style="width: 12px; height: 12px; background: var(--mud-palette-secondary); border-radius: 50%; margin-right: 8px;"></div>
                                <MudText Typo="Typo.body2" Color="Color.Default">Completed</MudText>
                            </div>
                            <MudText Typo="Typo.body2" Style="font-weight: 600;" Color="Color.Default">@_metrics.PurchaseOrdersCompleted</MudText>
                        </div>
                        <div class="d-flex justify-space-between align-center">
                            <div class="d-flex align-center">
                                <div style="width: 12px; height: 12px; background: var(--mud-palette-error); border-radius: 50%; margin-right: 8px;"></div>
                                <MudText Typo="Typo.body2" Color="Color.Default">Cancelled</MudText>
                            </div>
                            <MudText Typo="Typo.body2" Style="font-weight: 600;" Color="Color.Default">@_metrics.PurchaseOrdersCancelled</MudText>
                        </div>
                    </div>
                </MudCard>
            </MudItem>

            <!-- Stock Level Status -->
            <MudItem xs="12" md="7">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="height: 450px;">
                    <MudText Typo="Typo.h6" Style="font-weight: 600;" Class="mb-3" Color="Color.Default">Stock Level Overview</MudText>
                    
                    @if (_stockItems.Count > 0)
                    {
                        <div style="height: 380px; overflow-y: auto;">
                            <MudTable Items="@_stockItems" Dense="true" Hover="true" Striped="true" Elevation="@_preference.Elevation">
                                <HeaderContent>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">SKU</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Product</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Stock</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Reorder At</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Reorder Qty</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Status</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Lead Time</MudText></MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.Sku</MudText></MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.Product</MudText></MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.CurrentStock</MudText></MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.Threshold</MudText></MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.ReorderQuantity</MudText></MudTd>
                                    <MudTd>
                                        <MudChip T="string" Size="Size.Small" 
                                               Color="@(context.Status == "Low Stock" ? Color.Error : Color.Success)"
                                               Text="@context.Status" />
                                    </MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.LeadTime</MudText></MudTd>
                                </RowTemplate>
                            </MudTable>
                        </div>
                    }
                    else
                    {
                        <div class="d-flex justify-center align-center" style="height: 380px;">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">No stock data available</MudText>
                        </div>
                    }
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- Stock Chart -->
        @if (_charts.StockDatasets.Count > 0)
        {
            <MudGrid GutterSize="3" Class="mt-4">
                <MudItem xs="12">
                    <MudCard Elevation="@_preference.Elevation" Class="pa-4">
                        <MudText Typo="Typo.h6" Style="font-weight: 600;" Class="mb-3" Color="Color.Default">Inventory Levels - Top Items</MudText>
                        <div style="height: 300px;">
                            <MudChart ChartType="ChartType.Bar" 
                                      ChartSeries="@_charts.StockDatasets" 
                                      XAxisLabels="@_charts.StockLabels"
                                      Width="100%" Height="300px" />
                        </div>
                    </MudCard>
                </MudItem>
            </MudGrid>
        }

        <!-- Analytics Row - Category Distribution & Sales Imports -->
        <MudGrid GutterSize="3" Class="mt-4">
            <!-- Category Distribution (Pie Chart) -->
            <MudItem xs="12" md="5">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="height: 450px;">
                    <MudText Typo="Typo.h6" Style="font-weight: 600;" Class="mb-3" Color="Color.Default">
                        Items by Category
                    </MudText>
                    
                    @if (_categoryMetrics.Count > 0)
                    {
                        <div style="height: 250px;" class="d-flex justify-center align-center">
                            <MudChart ChartType="ChartType.Pie" 
                                      InputData="@_categoryMetrics.Select(c => (double)c.ItemCount).ToArray()" 
                                      InputLabels="@_categoryMetrics.Select(c => c.CategoryName).ToArray()"
                                      Width="250px" Height="250px" />
                        </div>
                        <MudDivider Class="my-3" />
                        <div style="height: 120px; overflow-y: auto;">
                            <MudStack Spacing="2">
                                @foreach (var category in _categoryMetrics.Take(5))
                                {
                                    <div class="d-flex justify-space-between align-center">
                                        <div class="d-flex align-center">
                                            <div style="width: 12px; height: 12px; background: @category.Color; border-radius: 50%; margin-right: 8px;"></div>
                                            <MudText Typo="Typo.body2" Color="Color.Default">@category.CategoryName</MudText>
                                        </div>
                                        <MudText Typo="Typo.body2" Style="font-weight: 600;" Color="Color.Default">
                                            @category.ItemCount.ToString("N0")
                                        </MudText>
                                    </div>
                                }
                            </MudStack>
                        </div>
                    }
                    else
                    {
                        <div class="d-flex justify-center align-center" style="height: 380px;">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">No category data available</MudText>
                        </div>
                    }
                </MudCard>
            </MudItem>

            <!-- Recent Sales Imports -->
            <MudItem xs="12" md="7">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="height: 450px;">
                    <div class="d-flex justify-space-between align-center mb-3">
                        <MudText Typo="Typo.h6" Style="font-weight: 600;" Color="Color.Default">Recent Sales Imports</MudText>
                        <MudIconButton Icon="@Icons.Material.Filled.Refresh" Size="Size.Small" Color="Color.Primary" OnClick="@LoadDashboardDataAsync" />
                    </div>
                    
                    @if (_salesImports.Count > 0)
                    {
                        <div style="height: 380px; overflow-y: auto;">
                            <MudTable Items="@_salesImports" Dense="true" Hover="true" Striped="true" Elevation="@_preference.Elevation">
                                <HeaderContent>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Import #</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Date</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Warehouse</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Records</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Processed</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Quantity</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Status</MudText></MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.ImportNumber</MudText></MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.ImportDate</MudText></MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.WarehouseName</MudText></MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.TotalRecords</MudText></MudTd>
                                    <MudTd>
                                        <MudText Color="Color.Default">
                                            @context.ProcessedRecords
                                            @if (context.ErrorRecords > 0)
                                            {
                                                <span style="color: var(--mud-palette-error);"> (@context.ErrorRecords errors)</span>
                                            }
                                        </MudText>
                                    </MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.TotalQuantity.ToString("N0")</MudText></MudTd>
                                    <MudTd>
                                        <MudChip T="string" Size="Size.Small" 
                                               Color="@(context.Status == "Completed" ? Color.Success : context.Status == "Processing" ? Color.Info : Color.Warning)"
                                               Text="@context.Status" />
                                    </MudTd>
                                </RowTemplate>
                            </MudTable>
                        </div>
                    }
                    else
                    {
                        <div class="d-flex justify-center align-center" style="height: 380px;">
                            <MudStack AlignItems="AlignItems.Center">
                                <MudIcon Icon="@Icons.Material.Filled.CloudUpload" Size="Size.Large" Color="Color.Secondary" />
                                <MudText Typo="Typo.body2" Color="Color.Secondary">No sales imports yet</MudText>
                            </MudStack>
                        </div>
                    }
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- Stock Adjustments & Inventory Transactions Row -->
        <MudGrid GutterSize="3" Class="mt-4">
            <!-- Recent Stock Adjustments -->
            <MudItem xs="12" md="6">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="height: 450px;">
                    <div class="d-flex justify-space-between align-center mb-3">
                        <MudText Typo="Typo.h6" Style="font-weight: 600;" Color="Color.Default">Stock Adjustments (This Month)</MudText>
                        <MudIconButton Icon="@Icons.Material.Filled.Refresh" Size="Size.Small" Color="Color.Primary" OnClick="@LoadDashboardDataAsync" />
                    </div>
                    
                    @if (_stockAdjustments.Count > 0)
                    {
                        <div style="height: 380px; overflow-y: auto;">
                            <MudTable Items="@_stockAdjustments" Dense="true" Hover="true" Striped="true" Elevation="@_preference.Elevation">
                                <HeaderContent>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Adjustment #</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Date</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Warehouse</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Type</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Items</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Status</MudText></MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.AdjustmentNumber</MudText></MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.AdjustmentDate</MudText></MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.WarehouseName</MudText></MudTd>
                                    <MudTd>
                                        <MudChip T="string" Size="Size.Small" 
                                               Color="@(context.AdjustmentType == "Increase" ? Color.Success : context.AdjustmentType == "Decrease" ? Color.Error : Color.Info)"
                                               Text="@context.AdjustmentType" />
                                    </MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.ItemCount</MudText></MudTd>
                                    <MudTd>
                                        <MudChip T="string" Size="Size.Small" 
                                               Color="@(context.Status == "Approved" ? Color.Success : context.Status == "Pending" ? Color.Warning : Color.Info)"
                                               Text="@context.Status" />
                                    </MudTd>
                                </RowTemplate>
                            </MudTable>
                        </div>
                    }
                    else
                    {
                        <div class="d-flex justify-center align-center" style="height: 380px;">
                            <MudStack AlignItems="AlignItems.Center">
                                <MudIcon Icon="@Icons.Material.Filled.EditNote" Size="Size.Large" Color="Color.Secondary" />
                                <MudText Typo="Typo.body2" Color="Color.Secondary">No adjustments this month</MudText>
                            </MudStack>
                        </div>
                    }
                </MudCard>
            </MudItem>

            <!-- Quick Stats Summary -->
            <MudItem xs="12" md="6">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="height: 450px;">
                    <MudText Typo="Typo.h6" Style="font-weight: 600;" Class="mb-3" Color="Color.Default">
                        Quick Stats Summary
                    </MudText>
                    
                    <MudStack Spacing="3">
                        <MudCard Elevation="@_preference.Elevation" Style="background: var(--mud-palette-surface);" Class="pa-3">
                            <div class="d-flex justify-space-between align-center">
                                <div>
                                    <MudText Typo="Typo.body2" Color="Color.Secondary">Inventory Turnover</MudText>
                                    <MudText Typo="Typo.h6" Color="Color.Default">
                                        @(_metrics is { TotalQuantitySold: > 0, TotalItems: > 0 } 
                                            ? ((_metrics.TotalQuantitySold / (double)_metrics.TotalItems) * 100).ToString("F1") + "%"
                                            : "N/A")
                                    </MudText>
                                </div>
                                <MudIcon Icon="@Icons.Material.Filled.TrendingUp" Color="Color.Success" Size="Size.Large" />
                            </div>
                        </MudCard>

                        <MudCard Elevation="@_preference.Elevation" Style="background: var(--mud-palette-surface);" Class="pa-3">
                            <div class="d-flex justify-space-between align-center">
                                <div>
                                    <MudText Typo="Typo.body2" Color="Color.Secondary">PO Fulfillment Rate</MudText>
                                    <MudText Typo="Typo.h6" Color="Color.Default">
                                        @((_metrics.PurchaseOrdersCompleted + _metrics.PurchaseOrdersPending + _metrics.PurchaseOrdersApproved) > 0 
                                            ? ((_metrics.PurchaseOrdersCompleted / (double)(_metrics.PurchaseOrdersCompleted + _metrics.PurchaseOrdersPending + _metrics.PurchaseOrdersApproved)) * 100).ToString("F1") + "%"
                                            : "N/A")
                                    </MudText>
                                </div>
                                <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Info" Size="Size.Large" />
                            </div>
                        </MudCard>

                        <MudCard Elevation="@_preference.Elevation" Style="background: var(--mud-palette-surface);" Class="pa-3">
                            <div class="d-flex justify-space-between align-center">
                                <div>
                                    <MudText Typo="Typo.body2" Color="Color.Secondary">Stock Health Score</MudText>
                                    <MudText Typo="Typo.h6" Color="Color.Default">
                                        @(_metrics.TotalItems > 0 
                                            ? (((double)(_metrics.TotalItems - _metrics.LowStockItems) / _metrics.TotalItems) * 100).ToString("F1") + "%"
                                            : "N/A")
                                    </MudText>
                                </div>
                                <MudIcon Icon="@Icons.Material.Filled.HealthAndSafety" 
                                       Color="@(_metrics.LowStockItems > (_metrics.TotalItems * 0.1) ? Color.Warning : Color.Success)" 
                                       Size="Size.Large" />
                            </div>
                        </MudCard>

                        <MudCard Elevation="@_preference.Elevation" Style="background: var(--mud-palette-surface);" Class="pa-3">
                            <div class="d-flex justify-space-between align-center">
                                <div>
                                    <MudText Typo="Typo.body2" Color="Color.Secondary">Active Operations</MudText>
                                    <MudText Typo="Typo.h6" Color="Color.Default">
                                        @(_metrics.ActivePickLists + _metrics.CycleCountsInProgress + _metrics.InventoryTransfersPending)
                                    </MudText>
                                    <MudText Typo="Typo.caption" Color="Color.Secondary">
                                        @_metrics.ActivePickLists picks · @_metrics.CycleCountsInProgress counts · @_metrics.InventoryTransfersPending transfers
                                    </MudText>
                                </div>
                                <MudIcon Icon="@Icons.Material.Filled.LocalActivity" Color="Color.Primary" Size="Size.Large" />
                            </div>
                        </MudCard>
                    </MudStack>
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- Warehouse Operations Row -->
        <MudGrid GutterSize="3" Class="mt-4">
            <!-- Recent Goods Receipts -->
            <MudItem xs="12" md="6">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="height: 450px;">
                    <div class="d-flex justify-space-between align-center mb-3">
                        <MudText Typo="Typo.h6" Style="font-weight: 600;" Color="Color.Default">Recent Goods Receipts</MudText>
                        <MudIconButton Icon="@Icons.Material.Filled.Refresh" Size="Size.Small" Color="Color.Primary" OnClick="@LoadDashboardDataAsync" />
                    </div>
                    
                    @if (_goodsReceipts.Count > 0)
                    {
                        <div style="height: 380px; overflow-y: auto;">
                            <MudTable Items="@_goodsReceipts" Dense="true" Hover="true" Striped="true" Elevation="0">
                                <HeaderContent>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Receipt #</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">PO #</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Warehouse</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Received Date</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Status</MudText></MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.ReceiptNumber</MudText></MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.PurchaseOrderNumber</MudText></MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.WarehouseName</MudText></MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.ReceivedDate</MudText></MudTd>
                                    <MudTd>
                                        <MudChip T="string" Size="Size.Small" 
                                               Color="@(context.Status == "Completed" ? Color.Success : Color.Warning)"
                                               Text="@context.Status" />
                                    </MudTd>
                                </RowTemplate>
                            </MudTable>
                        </div>
                    }
                    else
                    {
                        <div class="d-flex justify-center align-center" style="height: 380px;">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">No goods receipts yet</MudText>
                        </div>
                    }
                </MudCard>
            </MudItem>

            <!-- Active Inventory Transfers -->
            <MudItem xs="12" md="6">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="height: 450px;">
                    <div class="d-flex justify-space-between align-center mb-3">
                        <MudText Typo="Typo.h6" Style="font-weight: 600;" Color="Color.Default">Active Inventory Transfers</MudText>
                        <MudIconButton Icon="@Icons.Material.Filled.Refresh" Size="Size.Small" Color="Color.Primary" OnClick="@LoadDashboardDataAsync" />
                    </div>
                    
                    @if (_inventoryTransfers.Count > 0)
                    {
                        <div style="height: 380px; overflow-y: auto;">
                            <MudTable Items="@_inventoryTransfers" Dense="true" Hover="true" Striped="true" Elevation="0">
                                <HeaderContent>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Transfer #</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">From</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">To</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Items</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Status</MudText></MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.TransferNumber</MudText></MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.FromWarehouse</MudText></MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.ToWarehouse</MudText></MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.ItemCount</MudText></MudTd>
                                    <MudTd>
                                        <MudChip T="string" Size="Size.Small" 
                                               Color="@GetTransferStatusColor(context.Status)"
                                               Text="@context.Status" />
                                    </MudTd>
                                </RowTemplate>
                            </MudTable>
                        </div>
                    }
                    else
                    {
                        <div class="d-flex justify-center align-center" style="height: 380px;">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">No active transfers</MudText>
                        </div>
                    }
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- Pick Lists and Put Away Tasks Row -->
        <MudGrid GutterSize="3" Class="mt-4">
            <!-- Active Pick Lists -->
            <MudItem xs="12" md="6">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="height: 450px;">
                    <div class="d-flex justify-space-between align-center mb-3">
                        <MudText Typo="Typo.h6" Style="font-weight: 600;" Color="Color.Default">Active Pick Lists</MudText>
                        <MudIconButton Icon="@Icons.Material.Filled.Refresh" Size="Size.Small" Color="Color.Primary" OnClick="@LoadDashboardDataAsync" />
                    </div>
                    
                    @if (_pickLists.Count > 0)
                    {
                        <div style="height: 380px; overflow-y: auto;">
                            <MudTable Items="@_pickLists" Dense="true" Hover="true" Striped="true" Elevation="0">
                                <HeaderContent>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Pick List #</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Warehouse</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Assigned To</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Priority</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Status</MudText></MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.PickListNumber</MudText></MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.WarehouseName</MudText></MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.AssignedTo</MudText></MudTd>
                                    <MudTd>
                                        <MudChip T="string" Size="Size.Small" 
                                               Color="@GetPriorityColor(context.Priority)"
                                               Text="@context.Priority" />
                                    </MudTd>
                                    <MudTd>
                                        <MudChip T="string" Size="Size.Small" 
                                               Color="@GetPickListStatusColor(context.Status)"
                                               Text="@context.Status" />
                                    </MudTd>
                                </RowTemplate>
                            </MudTable>
                        </div>
                    }
                    else
                    {
                        <div class="d-flex justify-center align-center" style="height: 380px;">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">No active pick lists</MudText>
                        </div>
                    }
                </MudCard>
            </MudItem>

            <!-- Put Away Tasks -->
            <MudItem xs="12" md="6">
                <MudCard Elevation="@_preference.Elevation" Class="pa-4" Style="height: 450px;">
                    <div class="d-flex justify-space-between align-center mb-3">
                        <MudText Typo="Typo.h6" Style="font-weight: 600;" Color="Color.Default">Put Away Tasks</MudText>
                        <MudIconButton Icon="@Icons.Material.Filled.Refresh" Size="Size.Small" Color="Color.Primary" OnClick="@LoadDashboardDataAsync" />
                    </div>
                    
                    @if (_putAwayTasks.Count > 0)
                    {
                        <div style="height: 380px; overflow-y: auto;">
                            <MudTable Items="@_putAwayTasks" Dense="true" Hover="true" Striped="true" Elevation="0">
                                <HeaderContent>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Task #</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Warehouse</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Items</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Assigned To</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Status</MudText></MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.TaskNumber</MudText></MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.WarehouseName</MudText></MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.ItemCount</MudText></MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.AssignedTo</MudText></MudTd>
                                    <MudTd>
                                        <MudChip T="string" Size="Size.Small" 
                                               Color="@GetPutAwayStatusColor(context.Status)"
                                               Text="@context.Status" />
                                    </MudTd>
                                </RowTemplate>
                            </MudTable>
                        </div>
                    }
                    else
                    {
                        <div class="d-flex justify-center align-center" style="height: 380px;">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">No put away tasks</MudText>
                        </div>
                    }
                </MudCard>
            </MudItem>
        </MudGrid>
    </MudContainer>
}

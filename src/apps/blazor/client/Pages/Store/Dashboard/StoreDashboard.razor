@page "/store/dashboard"

<PageHeader Title="Store Dashboard" Header="Warehouse & Inventory Management" SubHeader="Real-time insights into your store operations" />

@if (_loading)
{
    <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="mt-4" />
}
else
{
    <MudContainer MaxWidth="MaxWidth.False" Class="mt-4">
        <!-- Top KPI Row -->
        <MudGrid GutterSize="3" Class="mb-4">
            <MudItem xs="12" sm="6" lg="3">
                <MudCard Class="pa-4" Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <div class="d-flex justify-space-between align-center">
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-1" Style="color: rgba(255,255,255,0.9);">Total Items</MudText>
                            <MudText Typo="Typo.h4" Style="font-weight: 600; color: white;">@_metrics.TotalItems.ToString("N0")</MudText>
                            <MudText Typo="Typo.caption" Class="mt-1" Style="color: rgba(255,255,255,0.8);">
                                <MudIcon Icon="@Icons.Material.Filled.Inventory" Size="Size.Small" Class="mr-1" Style="color: rgba(255,255,255,0.8);" />
                                Active inventory items
                            </MudText>
                        </div>
                        <MudAvatar Size="Size.Large" Style="background: rgba(255,255,255,0.2);">
                            <MudIcon Icon="@Icons.Material.Filled.ShoppingCart" Size="Size.Medium" Style="color: white;" />
                        </MudAvatar>
                    </div>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" lg="3">
                <MudCard Class="pa-4" Style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                    <div class="d-flex justify-space-between align-center">
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-1" Style="color: rgba(255,255,255,0.9);">POs Completed</MudText>
                            <MudText Typo="Typo.h4" Style="font-weight: 600; color: white;">@_metrics.PurchaseOrdersCompleted.ToString("N0")</MudText>
                            <MudText Typo="Typo.caption" Class="mt-1" Style="color: rgba(255,255,255,0.8);">
                                <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Size="Size.Small" Class="mr-1" Style="color: rgba(255,255,255,0.8);" />
                                Received purchase orders
                            </MudText>
                        </div>
                        <MudAvatar Size="Size.Large" Style="background: rgba(255,255,255,0.2);">
                            <MudIcon Icon="@Icons.Material.Filled.DoneAll" Size="Size.Medium" Style="color: white;" />
                        </MudAvatar>
                    </div>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" lg="3">
                <MudCard Class="pa-4" Style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                    <div class="d-flex justify-space-between align-center">
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-1" Style="color: rgba(255,255,255,0.9);">Low Stock Items</MudText>
                            <MudText Typo="Typo.h4" Style="font-weight: 600; color: white;">@_metrics.LowStockItems.ToString("N0")</MudText>
                            <MudText Typo="Typo.caption" Class="mt-1" Style="color: rgba(255,255,255,0.8);">
                                <MudIcon Icon="@Icons.Material.Filled.Warning" Size="Size.Small" Class="mr-1" Style="color: rgba(255,255,255,0.8);" />
                                Below reorder point
                            </MudText>
                        </div>
                        <MudAvatar Size="Size.Large" Style="background: rgba(255,255,255,0.2);">
                            <MudIcon Icon="@Icons.Material.Filled.TrendingDown" Size="Size.Medium" Style="color: white;" />
                        </MudAvatar>
                    </div>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" lg="3">
                <MudCard Class="pa-4" Style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;">
                    <div class="d-flex justify-space-between align-center">
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-1" Style="color: rgba(255,255,255,0.9);">POs Pending</MudText>
                            <MudText Typo="Typo.h4" Style="font-weight: 600; color: white;">@_metrics.PurchaseOrdersPending.ToString("N0")</MudText>
                            <MudText Typo="Typo.caption" Class="mt-1" Style="color: rgba(255,255,255,0.8);">
                                <MudIcon Icon="@Icons.Material.Filled.HourglassEmpty" Size="Size.Small" Class="mr-1" Style="color: rgba(255,255,255,0.8);" />
                                Awaiting approval/action
                            </MudText>
                        </div>
                        <MudAvatar Size="Size.Large" Style="background: rgba(255,255,255,0.2);">
                            <MudIcon Icon="@Icons.Material.Filled.Schedule" Size="Size.Medium" Style="color: white;" />
                        </MudAvatar>
                    </div>
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- Secondary KPI Row -->
        <MudGrid GutterSize="3" Class="mb-4">
            <MudItem xs="12" sm="6" md="3">
                <MudCard Class="pa-3">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Warehouse" Color="Color.Info" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">Warehouses</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.WarehousesCount</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Active locations</MudText>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Class="pa-3">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Business" Color="Color.Success" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">Suppliers</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.SuppliersCount</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Registered vendors</MudText>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Class="pa-3">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.LocalShipping" Color="Color.Warning" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">POs Approved</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.PurchaseOrdersApproved</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Awaiting delivery</MudText>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Class="pa-3">
                    <div class="d-flex align-center mb-2">
                        <MudIcon Icon="@Icons.Material.Filled.Cancel" Color="Color.Error" Class="mr-2" />
                        <MudText Typo="Typo.body1" Style="font-weight: 600;">POs Cancelled</MudText>
                    </div>
                    <MudText Typo="Typo.h5" Color="Color.Default">@_metrics.PurchaseOrdersCancelled</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Cancelled orders</MudText>
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- Main Content Row -->
        <MudGrid GutterSize="3">
            <!-- Purchase Order Status (Donut Chart) -->
            <MudItem xs="12" md="5">
                <MudCard Class="pa-4" Style="height: 450px;">
                    <MudText Typo="Typo.h6" Style="font-weight: 600;" Class="mb-3" Color="Color.Default">Purchase Order Status</MudText>
                    <div style="height: 250px;" class="d-flex justify-center align-center">
                        @if (_charts.OrderSourceDatasets.Count > 0 && _charts.OrderSourceDatasets.First().Data.Any())
                        {
                            <MudChart ChartType="ChartType.Donut" 
                                      InputData="@_charts.OrderSourceDatasets.First().Data.Select(d => d).ToArray()" 
                                      InputLabels="@_charts.OrderSourceLabels"
                                      Width="250px" Height="250px" />
                        }
                        else
                        {
                            <MudText Typo="Typo.body2" Color="Color.Secondary">No purchase orders yet</MudText>
                        }
                    </div>
                    <div class="mt-4">
                        <div class="d-flex justify-space-between align-center mb-2">
                            <div class="d-flex align-center">
                                <div style="width: 12px; height: 12px; background: #43e97b; border-radius: 50%; margin-right: 8px;"></div>
                                <MudText Typo="Typo.body2" Color="Color.Default">Pending</MudText>
                            </div>
                            <MudText Typo="Typo.body2" Style="font-weight: 600;" Color="Color.Default">@_metrics.PurchaseOrdersPending</MudText>
                        </div>
                        <div class="d-flex justify-space-between align-center mb-2">
                            <div class="d-flex align-center">
                                <div style="width: 12px; height: 12px; background: #667eea; border-radius: 50%; margin-right: 8px;"></div>
                                <MudText Typo="Typo.body2" Color="Color.Default">Approved/Sent</MudText>
                            </div>
                            <MudText Typo="Typo.body2" Style="font-weight: 600;" Color="Color.Default">@_metrics.PurchaseOrdersApproved</MudText>
                        </div>
                        <div class="d-flex justify-space-between align-center mb-2">
                            <div class="d-flex align-center">
                                <div style="width: 12px; height: 12px; background: #f093fb; border-radius: 50%; margin-right: 8px;"></div>
                                <MudText Typo="Typo.body2" Color="Color.Default">Completed</MudText>
                            </div>
                            <MudText Typo="Typo.body2" Style="font-weight: 600;" Color="Color.Default">@_metrics.PurchaseOrdersCompleted</MudText>
                        </div>
                        <div class="d-flex justify-space-between align-center">
                            <div class="d-flex align-center">
                                <div style="width: 12px; height: 12px; background: #ea4335; border-radius: 50%; margin-right: 8px;"></div>
                                <MudText Typo="Typo.body2" Color="Color.Default">Cancelled</MudText>
                            </div>
                            <MudText Typo="Typo.body2" Style="font-weight: 600;" Color="Color.Default">@_metrics.PurchaseOrdersCancelled</MudText>
                        </div>
                    </div>
                </MudCard>
            </MudItem>

            <!-- Stock Level Status -->
            <MudItem xs="12" md="7">
                <MudCard Class="pa-4" Style="height: 450px;">
                    <MudText Typo="Typo.h6" Style="font-weight: 600;" Class="mb-3" Color="Color.Default">Stock Level Overview</MudText>
                    
                    @if (_stockItems.Count > 0)
                    {
                        <div style="height: 380px; overflow-y: auto;">
                            <MudTable Items="@_stockItems" Dense="true" Hover="true" Striped="true" Elevation="0">
                                <HeaderContent>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">SKU</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Product</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Stock</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Reorder At</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Reorder Qty</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Status</MudText></MudTh>
                                    <MudTh Style="font-weight: 600;"><MudText Color="Color.Default">Lead Time</MudText></MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.Sku</MudText></MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.Product</MudText></MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.CurrentStock</MudText></MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.Threshold</MudText></MudTd>
                                    <MudTd><MudText Color="Color.Default">@context.ReorderQuantity</MudText></MudTd>
                                    <MudTd>
                                        <MudChip T="string" Size="Size.Small" 
                                               Color="@(context.Status == "Low Stock" ? Color.Error : Color.Success)"
                                               Text="@context.Status" />
                                    </MudTd>
                                    <MudTd><MudText Typo="Typo.caption" Color="Color.Default">@context.LeadTime</MudText></MudTd>
                                </RowTemplate>
                            </MudTable>
                        </div>
                    }
                    else
                    {
                        <div class="d-flex justify-center align-center" style="height: 380px;">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">No stock data available</MudText>
                        </div>
                    }
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- Stock Chart -->
        @if (_charts.StockDatasets.Count > 0)
        {
            <MudGrid GutterSize="3" Class="mt-4">
                <MudItem xs="12">
                    <MudCard Class="pa-4">
                        <MudText Typo="Typo.h6" Style="font-weight: 600;" Class="mb-3" Color="Color.Default">Inventory Levels - Top Items</MudText>
                        <div style="height: 300px;">
                            <MudChart ChartType="ChartType.Bar" 
                                      ChartSeries="@_charts.StockDatasets" 
                                      XAxisLabels="@_charts.StockLabels"
                                      Width="100%" Height="300px" />
                        </div>
                    </MudCard>
                </MudItem>
            </MudGrid>
        }
    </MudContainer>
}

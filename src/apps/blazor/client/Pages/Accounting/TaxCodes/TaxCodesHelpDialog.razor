@namespace FSH.Starter.Blazor.Client.Pages.Accounting.TaxCodes

<MudDialog>
    <DialogContent>
        <MudStack Spacing="3">

            <MudExpansionPanels Elevation="@_preference.Elevation">
                <MudExpansionPanel Text="What are Tax Codes?" Icon="@Icons.Material.Filled.MenuBook">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle2">Understanding Tax Codes</MudText>
                        <MudText Typo="Typo.body2">
                            Tax codes are categories used to classify transactions for tax reporting purposes. 
                            They track taxable and tax-exempt items, enabling proper calculation of sales tax, 
                            VAT (Value Added Tax), and other consumption taxes for compliance and reporting.
                        </MudText>
                        
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Why Tax Codes Matter:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                • <strong>Tax Compliance:</strong> Correctly calculate and report taxes<br/>
                                • <strong>Audit Support:</strong> Demonstrate tax compliance<br/>
                                • <strong>Accurate Reporting:</strong> Sales tax, VAT, GST calculations<br/>
                                • <strong>Automation:</strong> Automatic tax calculation on transactions<br/>
                                • <strong>Multi-Jurisdiction:</strong> Different tax rates by location
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Common Tax Types:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                • <strong>Sales Tax:</strong> US state/local consumption tax (2-10%)<br/>
                                • <strong>VAT (Value Added Tax):</strong> EU/Canada consumption tax (15-25%)<br/>
                                • <strong>GST (Goods & Services Tax):</strong> Australian/NZ consumption tax (10-15%)<br/>
                                • <strong>HST:</strong> Canadian harmonized sales tax<br/>
                                • <strong>Tariffs:</strong> Import/export duties
                            </MudText>
                        </div>

                        <MudAlert Severity="Severity.Info" Dense="true">
                            <strong>Key Principle:</strong> Different items have different tax rates - must categorize correctly!
                        </MudAlert>
                    </MudStack>
                </MudExpansionPanel>

                <MudExpansionPanel Text="Tax-Exempt vs. Taxable" Icon="@Icons.Material.Filled.Info">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle2">Item Classification</MudText>
                        
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Taxable Items (most sales):</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                • Most goods and services<br/>
                                • Subject to full sales tax rate<br/>
                                • Example: Electronics (8% tax in CA)<br/>
                                • Sale of $100 → Tax $8 → Total $108
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Tax-Exempt Items (common examples):</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                • <strong>Food:</strong> Grocery items (not prepared food)<br/>
                                • <strong>Medicines:</strong> Prescription drugs (not vitamins)<br/>
                                • <strong>Medical Equipment:</strong> Wheelchairs, canes<br/>
                                • <strong>Government Purchases:</strong> Usually exempt<br/>
                                • <strong>Non-Profit Organizations:</strong> Often exempt<br/>
                                • <strong>Resale:</strong> Wholesale/resellers don't pay tax
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Reduced Rate Items:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                Some jurisdictions have reduced rates:<br/>
                                • Books (0-5%)<br/>
                                • Children's clothing (0%)<br/>
                                • Residential utilities<br/>
                                • Energy/fuel (sometimes)
                            </MudText>
                        </div>

                        <MudAlert Severity="Severity.Warning" Dense="true">
                            <strong>Critical:</strong> Misclassifying tax codes leads to incorrect tax remittance and audit problems!
                        </MudAlert>
                    </MudStack>
                </MudExpansionPanel>

                <MudExpansionPanel Text="Creating and Managing Tax Codes" Icon="@Icons.Material.Filled.AddCircle">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle2">How to Set Up Tax Codes</MudText>
                        
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Tax Code Setup Steps:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                1. Click <strong>"Create"</strong> button<br/>
                                2. Enter <strong>Tax Code</strong> (e.g., "STATE-TAX-8%")<br/>
                                3. Enter <strong>Description</strong> (e.g., "CA State Tax 8%")<br/>
                                4. Select <strong>Tax Type</strong> (Sales Tax, VAT, GST, etc.)<br/>
                                5. Enter <strong>Tax Rate</strong> (e.g., 8.00%)<br/>
                                6. Select <strong>Jurisdiction</strong> (California)<br/>
                                7. Indicate if <strong>Taxable</strong> or <strong>Tax-Exempt</strong><br/>
                                8. Enter <strong>Effective Date</strong><br/>
                                9. Enter <strong>Expiration Date</strong> (if applicable)<br/>
                                10. Mark as <strong>Active</strong><br/>
                                11. Click <strong>"Save"</strong>
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Typical Tax Code Structure:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption" Style="font-family: monospace; background: #f5f5f5; padding: 10px; border-radius: 4px;">
                                Code: CA-STATE-8<br/>
                                Name: California State Tax 8%<br/>
                                Type: Sales Tax<br/>
                                Rate: 8.00%<br/>
                                Jurisdiction: California<br/>
                                Taxable: Yes<br/>
                                Effective: 01/01/2025<br/>
                                Status: Active
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Multi-Rate Setup (Combined Taxes):</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                Many locations combine state + local taxes:<br/>
                                <br/>
                                State Tax: 5%<br/>
                                Local Tax: 2%<br/>
                                Combined: 7%<br/>
                                <br/>
                                Can track separately or combine into one code
                            </MudText>
                        </div>

                        <MudAlert Severity="Severity.Success" Dense="true">
                            <strong>Best Practice:</strong> Review tax codes annually for rate changes and new regulations!
                        </MudAlert>
                    </MudStack>
                </MudExpansionPanel>

                <MudExpansionPanel Text="Assigning Tax Codes to Items" Icon="@Icons.Material.Filled.Info">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle2">Linking Items to Tax Codes</MudText>
                        
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Assignment Process:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                Each item (product/service) must have default tax code:<br/>
                                <br/>
                                1. Open item master record<br/>
                                2. Select <strong>Default Tax Code</strong><br/>
                                3. Can override at transaction level if needed<br/>
                                4. Save item
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Example Item Setup:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption" Style="font-family: monospace; background: #f5f5f5; padding: 10px; border-radius: 4px;">
                                Item: Laptop Computer<br/>
                                Category: Electronics<br/>
                                Default Tax Code: CA-STATE-8<br/>
                                <br/>
                                When sold:<br/>
                                Price: $1,000<br/>
                                Tax (8%): $80<br/>
                                Total: $1,080
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Tax-Exempt Item Example:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption" Style="font-family: monospace; background: #f5f5f5; padding: 10px; border-radius: 4px;">
                                Item: Prescription Medicine<br/>
                                Category: Healthcare<br/>
                                Default Tax Code: TAX-EXEMPT<br/>
                                <br/>
                                When sold:<br/>
                                Price: $50<br/>
                                Tax: $0<br/>
                                Total: $50
                            </MudText>
                        </div>

                        <MudAlert Severity="Severity.Info" Dense="true">
                            <strong>Tip:</strong> Use consistent naming for tax codes to make assignment easier and reduce errors.
                        </MudAlert>
                    </MudStack>
                </MudExpansionPanel>

                <MudExpansionPanel Text="Multi-Jurisdiction Tax Handling" Icon="@Icons.Material.Filled.Help">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle2">Different Rates by Location</MudText>
                        
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Jurisdiction Complexity:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                Same item has different tax rates in different places:<br/>
                                <br/>
                                <strong>Laptop Computer:</strong><br/>
                                • California: 8% tax<br/>
                                • Texas: 8.25% tax<br/>
                                • Oregon: 0% tax (no sales tax!)<br/>
                                • EU: 21% VAT
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Solution - Location-Based Tax Codes:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                Create separate tax codes by location:<br/>
                                <br/>
                                CA-SALES-TAX-8<br/>
                                TX-SALES-TAX-8.25<br/>
                                OR-EXEMPT-0<br/>
                                EU-VAT-21<br/>
                                <br/>
                                System applies correct code based on customer location
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Nexus Considerations:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                Only collect tax if company has "nexus" in jurisdiction:<br/>
                                • Physical location<br/>
                                • Employees<br/>
                                • Warehouses<br/>
                                • Sales over threshold<br/>
                                <br/>
                                Without nexus = no tax collection (usually)
                            </MudText>
                        </div>

                        <MudAlert Severity="Severity.Warning" Dense="true">
                            <strong>Important:</strong> Multi-state/country sellers must track nexus carefully - tax compliance is complex!
                        </MudAlert>
                    </MudStack>
                </MudExpansionPanel>

                <MudExpansionPanel Text="Tax Reporting" Icon="@Icons.Material.Filled.Assessment">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle2">Tax Liability Calculation</MudText>
                        
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Tax Liability Report:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption" Style="font-family: monospace; background: #f5f5f5; padding: 10px; border-radius: 4px;">
                                Sales Tax Liability - November 2025<br/>
                                <br/>
                                Tax Code              Taxable Sales    Tax Rate   Tax Owed<br/>
                                ==================   ==============   ========   ========<br/>
                                CA-STATE-8           $50,000          8.00%      $4,000<br/>
                                CA-LOCAL-2           $50,000          2.00%      $1,000<br/>
                                TX-COMBINED-8.25     $30,000          8.25%      $2,475<br/>
                                OR-EXEMPT-0          $20,000          0.00%      $0<br/>
                                ==================   ==============   ========   ========<br/>
                                TOTAL TAX OWED                                   $7,475
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Monthly Tax Filing:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                1. Generate tax liability report<br/>
                                2. Verify accuracy<br/>
                                3. File with tax authority<br/>
                                4. Remit payment (usually within 20 days)<br/>
                                5. Retain records for audit
                            </MudText>
                        </div>

                        <MudAlert Severity="Severity.Success" Dense="true">
                            <strong>Best Practice:</strong> Run tax reports weekly during month to catch errors early!
                        </MudAlert>
                    </MudStack>
                </MudExpansionPanel>

                <MudExpansionPanel Text="Common Questions (FAQ)" Icon="@Icons.Material.Filled.QuestionAnswer">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle2">Frequently Asked Questions</MudText>
                        
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Q: What happens if we apply wrong tax code?</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                A: Customer charged incorrect tax. Audit trail shows error. Correcting entry needed. Apologize and refund difference. Keep documentation.
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Q: Can customers override tax codes?</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                A: Yes - with documentation (resale certificate, tax-exempt status). Must be valid and on file. Audit trail required.
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Q: How do we handle tax rate changes?</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                A: Create new tax code with effective date. Inactivate old code. Existing sales remain with original rate. Future sales use new rate.
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Q: What if we sell in multiple countries?</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                A: Create tax codes for each country/rate. Track by ship-to address. Consider VAT/GST implications. May need tax advisor.
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Q: How long do we keep tax records?</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                A: Minimum 7 years for US federal. Check state/local rules - some require longer. Better to keep longer than dispose too early.
                            </MudText>
                        </div>
                    </MudStack>
                </MudExpansionPanel>
            </MudExpansionPanels>
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton Color="Color.Primary" OnClick="@(() => MudDialog.Close())">Close</MudButton>
    </DialogActions>
</MudDialog>
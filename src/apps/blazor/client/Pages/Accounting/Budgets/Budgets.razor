@page "/accounting/budgets"

<PageHeader Title="Accounting Periods" Header="Accounting Periods" SubHeader="Manage Accounting Periods." />

<MudPaper Elevation="2" Class="pa-4 mb-4">
    <MudStack Row="true" Spacing="2" Wrap="Wrap.Wrap" AlignItems="AlignItems.Center">
        <MudSpacer />
        <MudButtonGroup Color="Color.Info" Variant="Variant.Outlined" Size="Size.Small">
            <MudButton StartIcon="@Icons.Material.Filled.Help" OnClick="@ShowBudgetsHelp">
                Help
            </MudButton>
        </MudButtonGroup>
    </MudStack>
</MudPaper>

<EntityTable @ref="_table" TEntity="BudgetResponse" TId="DefaultIdType" TRequest="BudgetViewModel" Context="@Context">
    <ExtraActions Context="context">
        <MudMenuItem Icon="@Icons.Material.Filled.List" Href="@($"/accounting-budgetdetails/{Context.IdFunc!(context)}")">
            Details
        </MudMenuItem>
    </ExtraActions>
    <EditFormContent Context="context">
        @if (!Context.AddEditModal.IsCreate)
        {
            <MudItem xs="12" md="6" lg="4">
                <MudTextField Value="context.Id" Underline=false ReadOnly Label="Id" />
            </MudItem>
        }

        <MudItem xs="12">
            <MudTextField @bind-Value="context.Name"
                          For="@(() => context.Name)"
                          Label="Name"
                          Variant="Variant.Filled" />
        </MudItem>

        <MudItem xs="12" sm="12" md="6" lg="4">
            <AutocompleteAccountingPeriodId @bind-Value="context.PeriodId"
                                            For="@(() => context.PeriodId)"
                                            Label="Accounting Period"
                                            Variant="Variant.Filled" />
        </MudItem>

        <MudItem xs="6" sm="4" md="3" lg="2">
            <MudNumericField @bind-Value="context.FiscalYear"
                             For="@(() => context.FiscalYear)"
                             Label="Fiscal Year"
                             Variant="Variant.Filled" />
        </MudItem>

        <MudItem xs="12" sm="12" md="6" lg="4">
            <MudSelect T="string"
                       @bind-Value="context.BudgetType"
                       For="@(() => context.BudgetType!)"
                       Label="Budget Type"
                       Variant="Variant.Filled">
                <MudSelectItem Value="@("Operating Budget")">Operating Budget</MudSelectItem>
                <MudSelectItem Value="@("Capital Budget")">Capital Budget</MudSelectItem>
                <MudSelectItem Value="@("Cash Flow Budget")">Cash Flow Budget</MudSelectItem>
                <MudSelectItem Value="@("Master Budget")">Master Budget</MudSelectItem>
                <MudSelectItem Value="@("Static Budget")">Static Budget</MudSelectItem>
                <MudSelectItem Value="@("Flexible Budget")">Flexible Budget</MudSelectItem>
                <MudSelectItem Value="@("Zero-based Budget")">Zero-based Budget</MudSelectItem>
                <MudSelectItem Value="@("Rolling Budget")">Rolling Budget</MudSelectItem>
                <MudSelectItem Value="@("Project Budget")">Project Budget</MudSelectItem>
            </MudSelect>
        </MudItem>

        <MudItem xs="12" sm="6" md="4" lg="3">
            <MudTextField @bind-Value="context.Status"
                          For="@(() => context.Status)"
                          Label="Status"
                          ReadOnly="true"/>
        </MudItem>

        <MudItem xs="12">
            <MudTextField @bind-Value="context.Description"
                          For="@(() => context.Description)"
                          Label="Description"
                          Variant="Variant.Filled" />
        </MudItem>

        <MudItem xs="12">
            <MudTextField @bind-Value="context.Notes"
                          For="@(() => context.Notes)"
                          Label="Notes"
                          Variant="Variant.Filled" />
        </MudItem>

        @* Read-only totals and approval info: only visible when editing an existing budget *@
        @if (!Context.AddEditModal.IsCreate)
        {
            <MudItem xs="12" sm="6" md="4" lg="3">
                <MudNumericField Format="N2" Label="Total Budgeted" ReadOnly T="decimal" Value="context.TotalBudgetedAmount" Variant="Variant.Outlined" />
            </MudItem>

            <MudItem xs="12" sm="6" md="4" lg="3">
                <MudNumericField Format="N2" Label="Total Actual" ReadOnly T="decimal" Value="context.TotalActualAmount" Variant="Variant.Outlined" />
            </MudItem>

            <MudItem xs="12" sm="6" md="4" lg="3">
                <MudDatePicker @bind-Date="context.ApprovedDate" Disabled="true" Label="Approved Date" />
            </MudItem>

            <MudItem xs="12" sm="6" md="4" lg="3">
                <MudTextField Value="context.ApprovedBy" ReadOnly Label="Approved By" />
            </MudItem>
        }
    </EditFormContent>
</EntityTable>
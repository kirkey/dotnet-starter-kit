@namespace FSH.Starter.Blazor.Client.Pages.Accounting.Payments

<MudDialog>
    <DialogContent>
        <MudStack Spacing="3">
            <MudText Typo="Typo.h6">Payment Details</MudText>
            
            @if (Payment != null)
            {
                <!-- Payment Summary -->
                <MudGrid Spacing="2">
                    <MudItem xs="12" sm="6">
                        <MudStack Spacing="1">
                            <MudText Typo="Typo.caption" Color="Color.Default">Payment Number</MudText>
                            <MudText Typo="Typo.body1">@Payment.PaymentNumber</MudText>
                        </MudStack>
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudStack Spacing="1">
                            <MudText Typo="Typo.caption" Color="Color.Default">Payment Method</MudText>
                            <MudChip T="string" Color="Color.Info" Size="Size.Small">@Payment.PaymentMethod</MudChip>
                        </MudStack>
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudStack Spacing="1">
                            <MudText Typo="Typo.caption" Color="Color.Default">Payment Date</MudText>
                            <MudText Typo="Typo.body1">@Payment.PaymentDate.ToString("MMM dd, yyyy")</MudText>
                        </MudStack>
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudStack Spacing="1">
                            <MudText Typo="Typo.caption" Color="Color.Default">Amount</MudText>
                            <MudText Typo="Typo.body1" Color="Color.Success">@Payment.Amount.ToString("C")</MudText>
                        </MudStack>
                    </MudItem>
                    @if (!string.IsNullOrEmpty(Payment.ReferenceNumber))
                    {
                        <MudItem xs="12" sm="6">
                            <MudStack Spacing="1">
                                <MudText Typo="Typo.caption" Color="Color.Default">Reference #</MudText>
                                <MudText Typo="Typo.body1">@Payment.ReferenceNumber</MudText>
                            </MudStack>
                        </MudItem>
                    }
                    @if (!string.IsNullOrEmpty(Payment.DepositToAccountCode))
                    {
                        <MudItem xs="12" sm="6">
                            <MudStack Spacing="1">
                                <MudText Typo="Typo.caption" Color="Color.Default">Deposit Account</MudText>
                                <MudText Typo="Typo.body1">@Payment.DepositToAccountCode</MudText>
                            </MudStack>
                        </MudItem>
                    }
                </MudGrid>

                <!-- Amount Summary -->
                <MudAlert Severity="Severity.Info" Dense="true" Class="my-3">
                    <div class="d-flex justify-space-between">
                        <div>
                            <strong>Total Amount:</strong> @Payment.Amount.ToString("C")
                        </div>
                        <div>
                            <strong>Unapplied:</strong> @Payment.UnappliedAmount.ToString("C")
                        </div>
                        <div>
                            <strong>Allocated:</strong> @(Payment.Amount - Payment.UnappliedAmount).ToString("C")
                        </div>
                    </div>
                </MudAlert>

                <!-- Description & Notes -->
                @if (!string.IsNullOrEmpty(Payment.Description))
                {
                    <div>
                        <MudText Typo="Typo.caption" Color="Color.Default">Description</MudText>
                        <MudText Typo="Typo.body2">@Payment.Description</MudText>
                    </div>
                }

                @if (!string.IsNullOrEmpty(Payment.Notes))
                {
                    <div>
                        <MudText Typo="Typo.caption" Color="Color.Default">Notes</MudText>
                        <MudText Typo="Typo.body2">@Payment.Notes</MudText>
                    </div>
                }

                <!-- Allocations -->
                @if (Payment.Allocations?.Count > 0)
                {
                    <MudDivider Class="my-2" />
                    <MudText Typo="Typo.subtitle2">Allocations (@Payment.Allocations.Count)</MudText>
                    <MudTable Dense="true" Hover="true" Items="@Payment.Allocations" T="PaymentAllocationDto">
                        <HeaderContent>
                            <MudTh>Invoice/Reference</MudTh>
                            <MudTh Class="text-end">Amount</MudTh>
                        </HeaderContent>
                        <RowTemplate Context="allocation">
                            <MudTd>
                                <MudText Typo="Typo.body2">@allocation.InvoiceId</MudText>
                            </MudTd>
                            <MudTd Class="text-end">
                                <MudText Typo="Typo.body2">@allocation.Amount.ToString("C")</MudText>
                            </MudTd>
                        </RowTemplate>
                    </MudTable>
                }
            }
        </MudStack>
    </DialogContent>

    <DialogActions>
        <MudButton OnClick="@(() => MudDialog.Close())">Close</MudButton>
    </DialogActions>
</MudDialog>

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.SupportAgent" Class="mr-2" />
            Customer Case Details
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudField Label="Case Number" Variant="Variant.Outlined">@CustomerCase.CaseNumber</MudField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudField Label="Status" Variant="Variant.Outlined">
                    <MudChip T="string" Color="@GetStatusColor(CustomerCase.Status)" Size="Size.Small">
                        @CustomerCase.Status
                    </MudChip>
                </MudField>
            </MudItem>
            <MudItem xs="12">
                <MudField Label="Subject" Variant="Variant.Outlined">@CustomerCase.Subject</MudField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudField Label="Category" Variant="Variant.Outlined">@CustomerCase.Category</MudField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudField Label="Channel" Variant="Variant.Outlined">@CustomerCase.Channel</MudField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudField Label="Priority" Variant="Variant.Outlined">
                    <MudChip T="string" Color="@GetPriorityColor(CustomerCase.Priority)" Size="Size.Small">
                        @CustomerCase.Priority
                    </MudChip>
                </MudField>
            </MudItem>
            <MudItem xs="12" md="6">
                <MudField Label="SLA (Hours)" Variant="Variant.Outlined">@CustomerCase.SlaHours</MudField>
            </MudItem>
            <MudItem xs="12">
                <MudField Label="Description" Variant="Variant.Outlined" Lines="3">@CustomerCase.Description</MudField>
            </MudItem>

            @if (!string.IsNullOrEmpty(CustomerCase.AssignedToName))
            {
                <MudItem xs="12" md="6">
                    <MudField Label="Assigned To" Variant="Variant.Outlined">@CustomerCase.AssignedToName</MudField>
                </MudItem>
            }

            @if (!string.IsNullOrEmpty(CustomerCase.Resolution))
            {
                <MudItem xs="12">
                    <MudDivider Class="my-2" />
                    <MudText Typo="Typo.subtitle1" Class="mb-2">Resolution</MudText>
                </MudItem>
                <MudItem xs="12">
                    <MudField Label="Resolution" Variant="Variant.Outlined" Lines="2">@CustomerCase.Resolution</MudField>
                </MudItem>
                @if (CustomerCase.ResolvedAt.HasValue)
                {
                    <MudItem xs="12" md="6">
                        <MudField Label="Resolved At" Variant="Variant.Outlined">@CustomerCase.ResolvedAt.Value.ToString("dd MMM yyyy HH:mm")</MudField>
                    </MudItem>
                }
            }

            @if (CustomerCase.ClosedAt.HasValue)
            {
                <MudItem xs="12" md="6">
                    <MudField Label="Closed At" Variant="Variant.Outlined">@CustomerCase.ClosedAt.Value.ToString("dd MMM yyyy HH:mm")</MudField>
                </MudItem>
                @if (CustomerCase.SatisfactionScore.HasValue)
                {
                    <MudItem xs="12" md="6">
                        <MudField Label="Satisfaction Score" Variant="Variant.Outlined">
                            <MudRating ReadOnly="true" SelectedValue="@CustomerCase.SatisfactionScore.Value" />
                        </MudField>
                    </MudItem>
                }
            }
        </MudGrid>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="@Cancel" Variant="Variant.Filled" Color="Color.Primary">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [Parameter]
    public CustomerCaseResponse CustomerCase { get; set; } = null!;

    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = null!;

    private void Cancel() => MudDialog.Cancel();

    private Color GetStatusColor(string? status) => status switch
    {
        "Open" => Color.Info,
        "InProgress" => Color.Primary,
        "Escalated" => Color.Warning,
        "Resolved" => Color.Success,
        "Closed" => Color.Dark,
        _ => Color.Default
    };

    private Color GetPriorityColor(string? priority) => priority switch
    {
        "Low" => Color.Info,
        "Medium" => Color.Default,
        "High" => Color.Warning,
        "Critical" => Color.Error,
        _ => Color.Default
    };
}

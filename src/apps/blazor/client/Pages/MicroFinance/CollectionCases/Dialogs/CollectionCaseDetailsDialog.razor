@using FSH.Starter.WebApi.MicroFinance.Application.CollectionCases.Get.v1

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Collections" Class="mr-2" />
            Case Details - @Entity.CaseNumber
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudGrid>
            <MudItem xs="12">
                <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Case Information</strong></MudText>
                <MudDivider />
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Case Number</MudText>
                <MudText>@Entity.CaseNumber</MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Status</MudText>
                <MudChip T="string" Color="@GetStatusColor(Entity.Status)" Size="Size.Small">@Entity.Status</MudChip>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Priority</MudText>
                <MudChip T="string" Color="@GetPriorityColor(Entity.Priority)" Size="Size.Small">@Entity.Priority</MudChip>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Classification</MudText>
                <MudText>@Entity.Classification</MudText>
            </MudItem>

            <MudItem xs="12" Class="mt-4">
                <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Delinquency Details</strong></MudText>
                <MudDivider />
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudText Typo="Typo.caption">Days Past Due (At Open)</MudText>
                <MudText>@Entity.DaysPastDueAtOpen</MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudText Typo="Typo.caption">Current Days Past Due</MudText>
                <MudText Color="Color.Error"><strong>@Entity.CurrentDaysPastDue</strong></MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudText Typo="Typo.caption">Amount Overdue</MudText>
                <MudText Color="Color.Error"><strong>@Entity.AmountOverdue.ToString("N0")</strong></MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudText Typo="Typo.caption">Total Outstanding</MudText>
                <MudText>@Entity.TotalOutstanding.ToString("N0")</MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Amount Recovered</MudText>
                <MudText Color="Color.Success"><strong>@Entity.AmountRecovered.ToString("N0")</strong></MudText>
            </MudItem>

            <MudItem xs="12" Class="mt-4">
                <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Timeline</strong></MudText>
                <MudDivider />
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudText Typo="Typo.caption">Opened Date</MudText>
                <MudText>@Entity.OpenedDate.ToShortDateString()</MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudText Typo="Typo.caption">Assigned Date</MudText>
                <MudText>@(Entity.AssignedDate?.ToShortDateString() ?? "-")</MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudText Typo="Typo.caption">Last Contact</MudText>
                <MudText>@(Entity.LastContactDate?.ToShortDateString() ?? "Never")</MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudText Typo="Typo.caption">Next Follow-up</MudText>
                <MudText Color="@(Entity.NextFollowUpDate < DateOnly.FromDateTime(DateTime.Today) ? Color.Error : Color.Default)">
                    @(Entity.NextFollowUpDate?.ToShortDateString() ?? "-")
                </MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Contact Attempts</MudText>
                <MudText>@Entity.ContactAttempts</MudText>
            </MudItem>
            @if (Entity.ClosedDate.HasValue)
            {
                <MudItem xs="12" sm="6" md="4">
                    <MudText Typo="Typo.caption">Closed Date</MudText>
                    <MudText>@Entity.ClosedDate.Value.ToShortDateString()</MudText>
                </MudItem>
            }

            @if (!string.IsNullOrEmpty(Entity.Notes))
            {
                <MudItem xs="12" Class="mt-4">
                    <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Notes</strong></MudText>
                    <MudDivider />
                </MudItem>
                <MudItem xs="12">
                    <MudText>@Entity.Notes</MudText>
                </MudItem>
            }

            @if (!string.IsNullOrEmpty(Entity.ClosureReason))
            {
                <MudItem xs="12">
                    <MudAlert Severity="Severity.Info">
                        <strong>Closure Reason:</strong> @Entity.ClosureReason
                    </MudAlert>
                </MudItem>
            }
        </MudGrid>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="@Close" Variant="Variant.Text">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [Parameter]
    public CollectionCaseResponse Entity { get; set; } = null!;

    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = null!;

    private void Close() => MudDialog.Close();

    private Color GetStatusColor(string status) => status switch
    {
        "Open" => Color.Warning,
        "InProgress" => Color.Info,
        "Legal" => Color.Error,
        "Settled" => Color.Success,
        "Closed" => Color.Default,
        _ => Color.Default
    };

    private Color GetPriorityColor(string priority) => priority switch
    {
        "Critical" => Color.Error,
        "High" => Color.Warning,
        "Medium" => Color.Info,
        "Low" => Color.Default,
        _ => Color.Default
    };
}

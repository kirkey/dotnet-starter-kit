<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Description" Class="mr-2" />
            Application Details - @Entity.ApplicationNumber
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudGrid>
            <MudItem xs="12">
                <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Application Information</strong></MudText>
                <MudDivider />
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Application Number</MudText>
                <MudText>@Entity.ApplicationNumber</MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Application Date</MudText>
                <MudText>@Entity.ApplicationDate.ToShortDateString()</MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Status</MudText>
                <MudChip T="string" Color="@GetStatusColor(Entity.Status)" Size="Size.Small">@Entity.Status</MudChip>
            </MudItem>

            <MudItem xs="12" Class="mt-4">
                <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Loan Details</strong></MudText>
                <MudDivider />
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Requested Amount</MudText>
                <MudText><strong>@Entity.RequestedAmount.ToString("N0")</strong></MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Approved Amount</MudText>
                <MudText Color="@(Entity.ApprovedAmount.HasValue ? Color.Success : Color.Default)">
                    @(Entity.ApprovedAmount?.ToString("N0") ?? "-")
                </MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Requested Term</MudText>
                <MudText>@Entity.RequestedTermMonths months</MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Approved Term</MudText>
                <MudText>@(Entity.ApprovedTermMonths.HasValue ? $"{Entity.ApprovedTermMonths} months" : "-")</MudText>
            </MudItem>
            <MudItem xs="12" sm="8">
                <MudText Typo="Typo.caption">Purpose</MudText>
                <MudText>@(Entity.Purpose ?? "-")</MudText>
            </MudItem>

            <MudItem xs="12" Class="mt-4">
                <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Processing Information</strong></MudText>
                <MudDivider />
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Assigned At</MudText>
                <MudText>@(Entity.AssignedAt?.ToString("g") ?? "-")</MudText>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudText Typo="Typo.caption">Decision At</MudText>
                <MudText>@(Entity.DecisionAt?.ToString("g") ?? "-")</MudText>
            </MudItem>
            @if (!string.IsNullOrEmpty(Entity.RejectionReason))
            {
                <MudItem xs="12">
                    <MudAlert Severity="Severity.Error">
                        <strong>Rejection Reason:</strong> @Entity.RejectionReason
                    </MudAlert>
                </MudItem>
            }
            @if (Entity.LoanId.HasValue)
            {
                <MudItem xs="12">
                    <MudAlert Severity="Severity.Success">
                        Loan has been disbursed. Loan ID: @Entity.LoanId
                    </MudAlert>
                </MudItem>
            }
        </MudGrid>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="@Close" Variant="Variant.Text">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [Parameter]
    public LoanApplicationResponse Entity { get; set; } = null!;

    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = null!;

    private void Close() => MudDialog.Close();

    private Color GetStatusColor(string status) => status switch
    {
        "Draft" => Color.Default,
        "Submitted" => Color.Info,
        "UnderReview" => Color.Warning,
        "Approved" => Color.Success,
        "Rejected" => Color.Error,
        "Withdrawn" => Color.Dark,
        "Disbursed" => Color.Primary,
        _ => Color.Default
    };
}

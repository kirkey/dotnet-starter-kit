@page "/microfinance/aml-alerts"
@using FSH.Starter.Blazor.Client.Pages.MicroFinance.AmlAlerts.Dialogs
@using FSH.Starter.Blazor.Client.Components.EntityTable

<MudPaper Elevation="@_clientPreference.BorderRadius" Class="pa-4 mb-4" Style="@($"border-radius: {_clientPreference.BorderRadius}px;")">
    <MudStack Row="true" Class="mb-2" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
        <MudText Typo="Typo.h5">
            <MudIcon Icon="@Icons.Material.Filled.Security" Class="mr-2" />
            AML Alerts
        </MudText>
        <MudStack Row="true" Spacing="2">
            <MudButtonGroup Variant="Variant.Outlined" Size="Size.Small">
                <MudButton StartIcon="@Icons.Material.Filled.FilterAlt" Color="Color.Default">Status</MudButton>
                <MudMenu Icon="@Icons.Material.Filled.ArrowDropDown" Color="Color.Default">
                    <MudMenuItem OnClick="@(() => _selectedStatus = null)">All</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "New")">New</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Assigned")">Assigned</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "UnderReview")">Under Review</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Escalated")">Escalated</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Closed")">Closed</MudMenuItem>
                </MudMenu>
            </MudButtonGroup>
            <MudButtonGroup Variant="Variant.Outlined" Size="Size.Small">
                <MudButton StartIcon="@Icons.Material.Filled.Warning" Color="Color.Default">Severity</MudButton>
                <MudMenu Icon="@Icons.Material.Filled.ArrowDropDown" Color="Color.Default">
                    <MudMenuItem OnClick="@(() => _selectedSeverity = null)">All</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedSeverity = "Critical")">Critical</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedSeverity = "High")">High</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedSeverity = "Medium")">Medium</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedSeverity = "Low")">Low</MudMenuItem>
                </MudMenu>
            </MudButtonGroup>
            <MudIconButton Icon="@Icons.Material.Filled.Help" Color="Color.Primary" OnClick="ShowHelp" />
        </MudStack>
    </MudStack>
</MudPaper>

<EntityTable @ref="_table"
             TEntity="AmlAlertResponse"
             TId="DefaultIdType"
             TViewModel="AmlAlertViewModel"
             Context="@_context"
             Dense="true"
             Striped="true"
             Hover="true">
    <ActionsContent>
        <MudMenu Icon="@Icons.Material.Filled.MoreVert" Size="Size.Small" Dense="true">
            <MudMenuItem Icon="@Icons.Material.Filled.Info"
                        OnClick="@(() => ShowDetails(context))">
                View Details
            </MudMenuItem>
            @if (context.Status == "New")
            {
                <MudMenuItem Icon="@Icons.Material.Filled.AssignmentInd"
                            OnClick="@(() => AssignAlert(context))"
                            Disabled="@(!_canAssign)">
                    Assign
                </MudMenuItem>
            }
            @if (context.Status == "Assigned" || context.Status == "UnderReview")
            {
                <MudMenuItem Icon="@Icons.Material.Filled.CheckCircle"
                            OnClick="@(() => ConfirmAlert(context))"
                            Disabled="@(!_canConfirm)">
                    Confirm Alert
                </MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.RemoveCircle"
                            OnClick="@(() => ClearAlert(context))"
                            Disabled="@(!_canClear)">
                    Clear (False Positive)
                </MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.ArrowUpward"
                            OnClick="@(() => EscalateAlert(context))"
                            Disabled="@(!_canEscalate)">
                    Escalate
                </MudMenuItem>
            }
            @if (context.Status == "Confirmed" || context.Status == "Escalated")
            {
                <MudMenuItem Icon="@Icons.Material.Filled.Report"
                            OnClick="@(() => FileSar(context))"
                            Disabled="@(!_canFileSar)">
                    File SAR
                </MudMenuItem>
            }
            @if (context.Status != "Closed")
            {
                <MudMenuItem Icon="@Icons.Material.Filled.Close"
                            OnClick="@(() => CloseAlert(context))"
                            Disabled="@(!_canClose)">
                    Close Alert
                </MudMenuItem>
            }
        </MudMenu>
    </ActionsContent>
    <ExtraActions>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.Add"
                   OnClick="@(() => _table!.InvokeModal())"
                   Disabled="@(!_canCreate)">
            New Alert
        </MudButton>
    </ExtraActions>
</EntityTable>


@namespace FSH.Starter.Blazor.Client.Pages.MicroFinance.MarketingCampaigns

<MudDialog>
    <DialogContent>
        @if (Campaign != null)
        {
            <MudTabs Elevation="@_preference.Elevation" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-4">
                <MudTabPanel Text="Overview">
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudField Label="Code">@Campaign.Code</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Name">@Campaign.Name</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Campaign Type">@Campaign.CampaignType</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Status">
                                <MudChip T="string" Color="@GetStatusColor(Campaign.Status)" Size="Size.Small">@Campaign.Status</MudChip>
                            </MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Start Date">@Campaign.StartDate.ToString("yyyy-MM-dd")</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="End Date">@Campaign.EndDate?.ToString("yyyy-MM-dd")</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Channels">@Campaign.Channels</MudField>
                        </MudItem>
                        @if (!string.IsNullOrEmpty(Campaign.Description))
                        {
                            <MudItem xs="12">
                                <MudField Label="Description">@Campaign.Description</MudField>
                            </MudItem>
                        }
                    </MudGrid>
                </MudTabPanel>
                <MudTabPanel Text="Budget & Spend">
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudPaper Class="pa-4 text-center" Elevation="@_preference.Elevation">
                                <MudText Typo="Typo.h4">@Campaign.Budget.ToString("C")</MudText>
                                <MudText Typo="Typo.body2">Total Budget</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudPaper Class="pa-4 text-center" Elevation="@_preference.Elevation">
                                <MudText Typo="Typo.h4">@Campaign.SpentAmount.ToString("C")</MudText>
                                <MudText Typo="Typo.body2">Spent Amount</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="12">
                            <MudProgressLinear Value="@GetBudgetUtilization()" Color="Color.Primary" Size="Size.Large" />
                            <MudText Typo="Typo.caption">Budget Utilization: @GetBudgetUtilization().ToString("F1")%</MudText>
                        </MudItem>
                        @if (Campaign.Roi.HasValue)
                        {
                            <MudItem xs="12">
                                <MudField Label="ROI">@Campaign.Roi?.ToString("P2")</MudField>
                            </MudItem>
                        }
                    </MudGrid>
                </MudTabPanel>
                <MudTabPanel Text="Performance">
                    <MudGrid>
                        <MudItem xs="12" md="4">
                            <MudPaper Class="pa-4 text-center" Elevation="@_preference.Elevation">
                                <MudText Typo="Typo.h4">@Campaign.TargetAudience</MudText>
                                <MudText Typo="Typo.body2">Target Audience</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudPaper Class="pa-4 text-center" Elevation="@_preference.Elevation">
                                <MudText Typo="Typo.h4">@Campaign.ReachedCount</MudText>
                                <MudText Typo="Typo.body2">Reached</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudPaper Class="pa-4 text-center" Elevation="@_preference.Elevation">
                                <MudText Typo="Typo.h4">@Campaign.ResponseCount</MudText>
                                <MudText Typo="Typo.body2">Responses</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudPaper Class="pa-4 text-center" Elevation="@_preference.Elevation">
                                <MudText Typo="Typo.h4">@Campaign.ConversionCount</MudText>
                                <MudText Typo="Typo.body2">Conversions</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudPaper Class="pa-4 text-center" Elevation="@_preference.Elevation">
                                <MudText Typo="Typo.h4" Color="Color.Info">@Campaign.ResponseRate?.ToString("P1")</MudText>
                                <MudText Typo="Typo.body2">Response Rate</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudPaper Class="pa-4 text-center" Elevation="@_preference.Elevation">
                                <MudText Typo="Typo.h4" Color="Color.Success">@Campaign.ConversionRate?.ToString("P1")</MudText>
                                <MudText Typo="Typo.body2">Conversion Rate</MudText>
                            </MudPaper>
                        </MudItem>
                    </MudGrid>
                </MudTabPanel>
            </MudTabs>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = null!;

    [Parameter]
    public MarketingCampaignResponse? Campaign { get; set; }

    private void Close() => MudDialog.Close();

    private static Color GetStatusColor(string? status) => status?.ToLower() switch
    {
        "active" or "running" => Color.Success,
        "draft" or "scheduled" => Color.Warning,
        "completed" => Color.Info,
        "paused" or "cancelled" => Color.Error,
        _ => Color.Default
    };

    private double GetBudgetUtilization()
    {
        if (Campaign?.Budget > 0)
            return (double)(Campaign.SpentAmount / Campaign.Budget * 100);
        return 0;
    }
}

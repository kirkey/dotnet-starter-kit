@namespace FSH.Starter.Blazor.Client.Pages.MicroFinance.CreditBureauReports

<MudDialog>
    <DialogContent>
        @if (Report != null)
        {
            <MudTabs Elevation="@_preference.Elevation" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-4">
                <MudTabPanel Text="Overview">
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudField Label="Report Number">@Report.ReportNumber</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Bureau Name">@Report.BureauName</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Report Date">@Report.ReportDate.ToString("yyyy-MM-dd")</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Expiry Date">@Report.ExpiryDate?.ToString("yyyy-MM-dd")</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Status">
                                <MudChip T="string" Color="@GetStatusColor(Report.Status)" Size="Size.Small">@Report.Status</MudChip>
                            </MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Score Model">@Report.ScoreModel</MudField>
                        </MudItem>
                    </MudGrid>
                </MudTabPanel>
                <MudTabPanel Text="Credit Score">
                    <MudGrid>
                        <MudItem xs="12" md="4">
                            <MudPaper Class="pa-4 text-center" Elevation="@_preference.Elevation">
                                <MudText Typo="Typo.h3" Color="@GetScoreColor(Report.CreditScore)">@Report.CreditScore</MudText>
                                <MudText Typo="Typo.body2">Credit Score</MudText>
                                <MudText Typo="Typo.caption">(@Report.ScoreMin - @Report.ScoreMax)</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudPaper Class="pa-4 text-center" Elevation="@_preference.Elevation">
                                <MudText Typo="Typo.h4">@Report.RiskGrade</MudText>
                                <MudText Typo="Typo.body2">Risk Grade</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudPaper Class="pa-4 text-center" Elevation="@_preference.Elevation">
                                <MudText Typo="Typo.h4">@(Report.CreditUtilization?.ToString("P0") ?? "N/A")</MudText>
                                <MudText Typo="Typo.body2">Credit Utilization</MudText>
                            </MudPaper>
                        </MudItem>
                    </MudGrid>
                </MudTabPanel>
                <MudTabPanel Text="Account Summary">
                    <MudGrid>
                        <MudItem xs="12" md="4">
                            <MudField Label="Active Accounts">@Report.ActiveAccounts</MudField>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudField Label="Closed Accounts">@Report.ClosedAccounts</MudField>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudField Label="Delinquent Accounts">@Report.DelinquentAccounts</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Total Outstanding Balance">@Report.TotalOutstandingBalance?.ToString("C")</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Total Credit Limit">@Report.TotalCreditLimit?.ToString("C")</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Credit History (Months)">@Report.CreditHistoryMonths</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Recent Inquiries">@Report.RecentInquiries</MudField>
                        </MudItem>
                    </MudGrid>
                </MudTabPanel>
                <MudTabPanel Text="Payment History">
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudField Label="Late Payments (12 Months)">@Report.LatePayments12Months</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Late Payments (24 Months)">@Report.LatePayments24Months</MudField>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudField Label="Defaults">@Report.Defaults</MudField>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudField Label="Bankruptcies">@Report.Bankruptcies</MudField>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudField Label="Collections">@Report.Collections</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Public Records">@Report.PublicRecords</MudField>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudField Label="Debt to Income Ratio">@Report.DebtToIncomeRatio?.ToString("P2")</MudField>
                        </MudItem>
                    </MudGrid>
                </MudTabPanel>
            </MudTabs>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = null!;

    [Parameter]
    public CreditBureauReportResponse? Report { get; set; }

    private void Close() => MudDialog.Close();

    private static Color GetStatusColor(string? status) => status?.ToLower() switch
    {
        "valid" or "active" => Color.Success,
        "expired" => Color.Warning,
        "revoked" => Color.Error,
        _ => Color.Default
    };

    private static Color GetScoreColor(int? score) => score switch
    {
        >= 750 => Color.Success,
        >= 650 => Color.Info,
        >= 550 => Color.Warning,
        _ => Color.Error
    };
}

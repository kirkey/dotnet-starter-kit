@page "/microfinance/loan-guarantors"
@using FSH.Starter.Blazor.Client.Pages.MicroFinance.LoanGuarantors.Dialogs
@using FSH.Starter.Blazor.Client.Components.EntityTable

<MudPaper Elevation="@_clientPreference.BorderRadius" Class="pa-4 mb-4" Style="@($"border-radius: {_clientPreference.BorderRadius}px;")">
    <MudStack Row="true" Class="mb-2" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
        <MudText Typo="Typo.h5">
            <MudIcon Icon="@Icons.Material.Filled.GroupWork" Class="mr-2" />
            Loan Guarantors
        </MudText>
        <MudStack Row="true" Spacing="2">
            <MudButtonGroup Variant="Variant.Outlined" Size="Size.Small">
                <MudButton StartIcon="@Icons.Material.Filled.FilterAlt" Color="Color.Default">Status</MudButton>
                <MudMenu Icon="@Icons.Material.Filled.ArrowDropDown" Color="Color.Default">
                    <MudMenuItem OnClick="@(() => _selectedStatus = null)">All</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Pending")">Pending</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Approved")">Approved</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Rejected")">Rejected</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Expired")">Expired</MudMenuItem>
                </MudMenu>
            </MudButtonGroup>
            <MudIconButton Icon="@Icons.Material.Filled.Help" Color="Color.Primary" OnClick="ShowHelp" />
        </MudStack>
    </MudStack>
</MudPaper>

<EntityTable @ref="_table"
             TEntity="LoanGuarantorResponse"
             TId="DefaultIdType"
             TViewModel="LoanGuarantorViewModel"
             Context="@_context"
             Dense="true"
             Striped="true"
             Hover="true">
    <ActionsContent>
        <MudMenu Icon="@Icons.Material.Filled.MoreVert" Size="Size.Small" Dense="true">
            <MudMenuItem Icon="@Icons.Material.Filled.Info"
                        OnClick="@(() => ShowDetails(context))">
                View Details
            </MudMenuItem>
            @if (context.Status == "Pending")
            {
                <MudMenuItem Icon="@Icons.Material.Filled.Check"
                            OnClick="@(() => ApproveGuarantor(context))"
                            Disabled="@(!_canApprove)">
                    Approve
                </MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.Close"
                            OnClick="@(() => RejectGuarantor(context))"
                            Disabled="@(!_canReject)">
                    Reject
                </MudMenuItem>
            }
            @if (context.Status == "Approved")
            {
                <MudMenuItem Icon="@Icons.Material.Filled.Edit"
                            OnClick="@(() => UpdateAmount(context))"
                            Disabled="@(!_canUpdate)">
                    Update Amount
                </MudMenuItem>
            }
        </MudMenu>
    </ActionsContent>
    <ExtraActions>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.Add"
                   OnClick="@(() => _table!.InvokeModal())"
                   Disabled="@(!_canCreate)">
            Add Guarantor
        </MudButton>
    </ExtraActions>
</EntityTable>


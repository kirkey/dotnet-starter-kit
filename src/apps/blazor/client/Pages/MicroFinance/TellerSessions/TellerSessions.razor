@page "/microfinance/teller-sessions"
@using FSH.Starter.Blazor.Client.Pages.MicroFinance.TellerSessions.Dialogs
@using FSH.Starter.Blazor.Client.Components.EntityTable

<MudPaper Elevation="@_clientPreference.BorderRadius" Class="pa-4 mb-4" Style="@($"border-radius: {_clientPreference.BorderRadius}px;")">
    <MudStack Row="true" Class="mb-2" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
        <MudText Typo="Typo.h5">
            <MudIcon Icon="@Icons.Material.Filled.PointOfSale" Class="mr-2" />
            Teller Sessions
        </MudText>
        <MudStack Row="true" Spacing="2">
            <MudButtonGroup Variant="Variant.Outlined" Size="Size.Small">
                <MudButton StartIcon="@Icons.Material.Filled.FilterAlt" Color="Color.Default">Status</MudButton>
                <MudMenu Icon="@Icons.Material.Filled.ArrowDropDown" Color="Color.Default">
                    <MudMenuItem OnClick="@(() => _selectedStatus = null)">All</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Open")">Open</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Paused")">Paused</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Closed")">Closed</MudMenuItem>
                </MudMenu>
            </MudButtonGroup>
            <MudIconButton Icon="@Icons.Material.Filled.Help" Color="Color.Primary" OnClick="ShowHelp" />
        </MudStack>
    </MudStack>
</MudPaper>

<EntityTable @ref="_table"
             TEntity="TellerSessionResponse"
             TId="DefaultIdType"
             TViewModel="TellerSessionViewModel"
             Context="@_context"
             Dense="true"
             Striped="true"
             Hover="true">
    <ActionsContent>
        <MudMenu Icon="@Icons.Material.Filled.MoreVert" Size="Size.Small" Dense="true">
            <MudMenuItem Icon="@Icons.Material.Filled.Info"
                        OnClick="@(() => ShowDetails(context))">
                View Details
            </MudMenuItem>
            @if (context.Status == "Open")
            {
                <MudMenuItem Icon="@Icons.Material.Filled.AddCircle"
                            OnClick="@(() => RecordCashIn(context))"
                            Disabled="@(!_canRecordTransaction)">
                    Cash In
                </MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.RemoveCircle"
                            OnClick="@(() => RecordCashOut(context))"
                            Disabled="@(!_canRecordTransaction)">
                    Cash Out
                </MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.Pause"
                            OnClick="@(() => PauseSession(context))"
                            Disabled="@(!_canPause)">
                    Pause Session
                </MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.Close"
                            OnClick="@(() => CloseSession(context))"
                            Disabled="@(!_canClose)">
                    Close Session
                </MudMenuItem>
            }
            @if (context.Status == "Paused")
            {
                <MudMenuItem Icon="@Icons.Material.Filled.PlayArrow"
                            OnClick="@(() => ResumeSession(context))"
                            Disabled="@(!_canResume)">
                    Resume Session
                </MudMenuItem>
            }
            @if (context.Status == "Closed")
            {
                <MudMenuItem Icon="@Icons.Material.Filled.Verified"
                            OnClick="@(() => VerifySession(context))"
                            Disabled="@(!_canVerify)">
                    Verify Session
                </MudMenuItem>
            }
        </MudMenu>
    </ActionsContent>
    <ExtraActions>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.PlayArrow"
                   OnClick="@OpenSession"
                   Disabled="@(!_canOpen)">
            Open Session
        </MudButton>
    </ExtraActions>
</EntityTable>


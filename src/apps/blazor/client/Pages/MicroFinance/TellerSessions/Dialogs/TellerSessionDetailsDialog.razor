<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.PointOfSale" Class="mr-2" />
            Teller Session Details
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudGrid>
            <MudItem xs="12" sm="6">
                <MudText Typo="Typo.caption" Color="Color.Primary">Session Number</MudText>
                <MudText>@Session.SessionNumber</MudText>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudText Typo="Typo.caption" Color="Color.Primary">Status</MudText>
                <MudChip T="string" Size="Size.Small" Color="@GetStatusColor(Session.Status)">@Session.Status</MudChip>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudText Typo="Typo.caption" Color="Color.Primary">Teller</MudText>
                <MudText>@Session.TellerName</MudText>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudText Typo="Typo.caption" Color="Color.Primary">Branch</MudText>
                <MudText>@Session.BranchName</MudText>
            </MudItem>
            <MudItem xs="12">
                <MudDivider Class="my-2" />
                <MudText Typo="Typo.subtitle2" Class="mb-2">Balance Summary</MudText>
            </MudItem>
            <MudItem xs="12" sm="4">
                <MudText Typo="Typo.caption" Color="Color.Primary">Opening Balance</MudText>
                <MudText>KES @Session.OpeningBalance.ToString("N0")</MudText>
            </MudItem>
            <MudItem xs="12" sm="4">
                <MudText Typo="Typo.caption" Color="Color.Primary">Current Balance</MudText>
                <MudText Typo="Typo.h6" Color="Color.Success">KES @Session.CurrentBalance.ToString("N0")</MudText>
            </MudItem>
            @if (Session.Status == "Closed" || Session.Status == "Verified")
            {
                <MudItem xs="12" sm="4">
                    <MudText Typo="Typo.caption" Color="Color.Primary">Closing Balance</MudText>
                    <MudText>KES @Session.ClosingBalance?.ToString("N0")</MudText>
                </MudItem>
            }
            <MudItem xs="12">
                <MudDivider Class="my-2" />
                <MudText Typo="Typo.subtitle2" Class="mb-2">Transaction Summary</MudText>
            </MudItem>
            <MudItem xs="12" sm="4">
                <MudText Typo="Typo.caption" Color="Color.Primary">Total Cash In</MudText>
                <MudText Color="Color.Success">+ KES @Session.TotalCashIn.ToString("N0")</MudText>
            </MudItem>
            <MudItem xs="12" sm="4">
                <MudText Typo="Typo.caption" Color="Color.Primary">Total Cash Out</MudText>
                <MudText Color="Color.Error">- KES @Session.TotalCashOut.ToString("N0")</MudText>
            </MudItem>
            <MudItem xs="12" sm="4">
                <MudText Typo="Typo.caption" Color="Color.Primary">Transaction Count</MudText>
                <MudText>@Session.TransactionCount</MudText>
            </MudItem>
            <MudItem xs="12">
                <MudDivider Class="my-2" />
                <MudText Typo="Typo.subtitle2" Class="mb-2">Timing</MudText>
            </MudItem>
            <MudItem xs="12" sm="4">
                <MudText Typo="Typo.caption" Color="Color.Primary">Opened At</MudText>
                <MudText>@Session.OpenedAt?.ToString("dd/MM/yyyy HH:mm")</MudText>
            </MudItem>
            @if (Session.PausedAt.HasValue)
            {
                <MudItem xs="12" sm="4">
                    <MudText Typo="Typo.caption" Color="Color.Warning">Last Paused At</MudText>
                    <MudText>@Session.PausedAt?.ToString("dd/MM/yyyy HH:mm")</MudText>
                </MudItem>
            }
            @if (Session.ClosedAt.HasValue)
            {
                <MudItem xs="12" sm="4">
                    <MudText Typo="Typo.caption" Color="Color.Primary">Closed At</MudText>
                    <MudText>@Session.ClosedAt?.ToString("dd/MM/yyyy HH:mm")</MudText>
                </MudItem>
            }
            @if (Session.Variance.HasValue && Session.Variance != 0)
            {
                <MudItem xs="12">
                    <MudAlert Severity="Severity.Error">
                        <strong>Variance Detected:</strong> KES @Session.Variance?.ToString("N0")
                    </MudAlert>
                </MudItem>
            }
        </MudGrid>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="@Close" Variant="Variant.Text" Color="Color.Primary">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [Parameter]
    public TellerSessionResponse Session { get; set; } = null!;

    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = null!;

    private Color GetStatusColor(string? status) => status switch
    {
        "Open" => Color.Success,
        "Paused" => Color.Warning,
        "Closed" => Color.Default,
        "Verified" => Color.Info,
        _ => Color.Default
    };

    private void Close() => MudDialog.Close();
}

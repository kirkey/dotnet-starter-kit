@namespace FSH.Starter.Blazor.Client.Pages.MicroFinance.SavingsAccounts

<MudDialog>
    <DialogContent>
        <MudContainer Style="max-height: 70vh; overflow-y: auto;">
            @if (_loading)
            {
                <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
            }
            else if (_account != null)
            {
                <MudText Typo="Typo.subtitle1" Class="mb-3">
                    Account @_account.AccountNumber - @_account.MemberName
                </MudText>
                
                <MudText Typo="Typo.body2" Class="mb-2">
                    Current Balance: <strong>@_account.Balance.ToString("C2")</strong>
                </MudText>
                
                <MudAlert Severity="Severity.Info" Dense="true" Class="mb-3">
                    Transaction history is available via the API. This dialog shows account summary.
                </MudAlert>
                
                <MudSimpleTable Dense="true">
                    <tbody>
                        <tr>
                            <td style="width: 50%; font-weight: 500;">Total Deposits</td>
                            <td style="text-align: right; color: var(--mud-palette-success);">
                                +@_account.TotalDeposits.ToString("C2")
                            </td>
                        </tr>
                        <tr>
                            <td style="font-weight: 500;">Total Withdrawals</td>
                            <td style="text-align: right; color: var(--mud-palette-warning);">
                                -@_account.TotalWithdrawals.ToString("C2")
                            </td>
                        </tr>
                        <tr>
                            <td style="font-weight: 500;">Interest Earned</td>
                            <td style="text-align: right; color: var(--mud-palette-info);">
                                +@_account.TotalInterestEarned.ToString("C2")
                            </td>
                        </tr>
                        <tr style="border-top: 2px solid var(--mud-palette-divider);">
                            <td style="font-weight: 600;">Net Balance</td>
                            <td style="text-align: right; font-weight: 600;">
                                @_account.Balance.ToString("C2")
                            </td>
                        </tr>
                    </tbody>
                </MudSimpleTable>
            }
            else
            {
                <MudAlert Severity="Severity.Error">Account not found.</MudAlert>
            }
        </MudContainer>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="@Close" Color="Color.Primary" Variant="Variant.Filled">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = null!;

    [Parameter]
    public DefaultIdType AccountId { get; set; }

    private SavingsAccountResponse? _account;
    private bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadAccount();
    }

    private async Task LoadAccount()
    {
        _loading = true;
        try
        {
            _account = await ApiHelper.ExecuteCallGuardedAsync(
                () => Client.GetSavingsAccountAsync("1", AccountId),
                Snackbar);
        }
        finally
        {
            _loading = false;
        }
    }

    private void Close() => MudDialog.Close();
}

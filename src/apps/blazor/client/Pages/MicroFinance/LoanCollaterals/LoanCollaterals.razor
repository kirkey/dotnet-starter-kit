@page "/microfinance/loan-collaterals"
@using FSH.Starter.Blazor.Client.Components.EntityTable
@using FSH.Starter.Blazor.Client.Pages.MicroFinance.LoanCollaterals.Dialogs

<MudPaper Elevation="@_elevation" Style="@_borderRadius">
    <EntityTable @ref="_table"
                 TEntity="LoanCollateralResponse"
                 TId="DefaultIdType"
                 TViewModel="LoanCollateralViewModel"
                 Context="@_context"
                 Dense="true"
                 Striped="true"
                 Hover="true"
                 SearchFields="@(new[] { "LoanNumber", "CollateralType", "Description", "DocumentReference" })">

        <ActionsContent>
            <MudButtonGroup OverrideStyles="false">
                <MudIconButton Icon="@Icons.Material.Filled.Visibility"
                               Color="Color.Info"
                               Title="View Details"
                               OnClick="@(() => ViewDetails(context))" />
                @if (_canVerify && !context.IsVerified)
                {
                    <MudIconButton Icon="@Icons.Material.Filled.VerifiedUser"
                                   Color="Color.Success"
                                   Title="Verify"
                                   OnClick="@(() => VerifyCollateral(context))" />
                }
                @if (_canUpdateValuation)
                {
                    <MudIconButton Icon="@Icons.Material.Filled.Assessment"
                                   Color="Color.Primary"
                                   Title="Update Valuation"
                                   OnClick="@(() => UpdateValuation(context))" />
                }
                @if (_canPledge && context.Status != "Pledged")
                {
                    <MudIconButton Icon="@Icons.Material.Filled.Lock"
                                   Color="Color.Warning"
                                   Title="Pledge"
                                   OnClick="@(() => PledgeCollateral(context))" />
                }
                @if (_canRelease && context.Status == "Pledged")
                {
                    <MudIconButton Icon="@Icons.Material.Filled.LockOpen"
                                   Color="Color.Success"
                                   Title="Release"
                                   OnClick="@(() => ReleaseCollateral(context))" />
                }
                @if (_canSeize && context.Status == "Pledged")
                {
                    <MudIconButton Icon="@Icons.Material.Filled.Gavel"
                                   Color="Color.Error"
                                   Title="Seize"
                                   OnClick="@(() => SeizeCollateral(context))" />
                }
            </MudButtonGroup>
        </ActionsContent>

        <ExtraActions>
            <MudMenuItem Icon="@Icons.Material.Filled.Help" OnClick="@ShowHelp">Help</MudMenuItem>
        </ExtraActions>

    </EntityTable>
</MudPaper>

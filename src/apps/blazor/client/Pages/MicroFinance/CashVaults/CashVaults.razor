@page "/microfinance/cash-vaults"
@using FSH.Starter.Blazor.Client.Pages.MicroFinance.CashVaults.Dialogs
@using FSH.Starter.Blazor.Client.Components.EntityTable

<MudPaper Elevation="@_clientPreference.BorderRadius" Class="pa-4 mb-4" Style="@($"border-radius: {_clientPreference.BorderRadius}px;")">
    <MudStack Row="true" Class="mb-2" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
        <MudText Typo="Typo.h5">
            <MudIcon Icon="@Icons.Material.Filled.AccountBalanceWallet" Class="mr-2" />
            Cash Vaults
        </MudText>
        <MudStack Row="true" Spacing="2">
            <MudButtonGroup Variant="Variant.Outlined" Size="Size.Small">
                <MudButton StartIcon="@Icons.Material.Filled.FilterAlt" Color="Color.Default">Status</MudButton>
                <MudMenu Icon="@Icons.Material.Filled.ArrowDropDown" Color="Color.Default">
                    <MudMenuItem OnClick="@(() => _selectedStatus = null)">All</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Open")">Open</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Closed")">Closed</MudMenuItem>
                    <MudMenuItem OnClick="@(() => _selectedStatus = "Reconciling")">Reconciling</MudMenuItem>
                </MudMenu>
            </MudButtonGroup>
            <MudIconButton Icon="@Icons.Material.Filled.Help" Color="Color.Primary" OnClick="ShowHelp" />
        </MudStack>
    </MudStack>
</MudPaper>

<EntityTable @ref="_table"
             TEntity="CashVaultResponse"
             TId="DefaultIdType"
             TRequest="CashVaultViewModel"
             Context="@_context"
             Dense="true"
             Striped="true"
             Hover="true">
    <ActionsContent>
        <MudMenu Icon="@Icons.Material.Filled.MoreVert" Size="Size.Small" Dense="true">
            <MudMenuItem Icon="@Icons.Material.Filled.Info"
                        OnClick="@(() => ShowDetails(context))">
                View Details
            </MudMenuItem>
            @if (context.Status == "Closed")
            {
                <MudMenuItem Icon="@Icons.Material.Filled.PlayArrow"
                            OnClick="@(() => OpenDay(context))"
                            Disabled="@(!_canOpenDay)">
                    Open Day
                </MudMenuItem>
            }
            @if (context.Status == "Open")
            {
                <MudMenuItem Icon="@Icons.Material.Filled.AddCircle"
                            OnClick="@(() => Deposit(context))"
                            Disabled="@(!_canDeposit)">
                    Deposit
                </MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.RemoveCircle"
                            OnClick="@(() => Withdraw(context))"
                            Disabled="@(!_canWithdraw)">
                    Withdraw
                </MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.Balance"
                            OnClick="@(() => Reconcile(context))"
                            Disabled="@(!_canReconcile)">
                    Reconcile
                </MudMenuItem>
            }
        </MudMenu>
    </ActionsContent>
    <ExtraActions>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.Add"
                   OnClick="@(() => _table!.InvokeModal())"
                   Disabled="@(!_canCreate)">
            New Vault
        </MudButton>
    </ExtraActions>
</EntityTable>


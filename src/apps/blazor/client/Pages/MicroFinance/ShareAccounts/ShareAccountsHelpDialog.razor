@namespace FSH.Starter.Blazor.Client.Pages.MicroFinance.ShareAccounts

<MudDialog>
    <DialogContent>
        <MudStack Spacing="3">
            <MudText Typo="Typo.h6">Share Accounts Help</MudText>

            <MudExpansionPanels Elevation="@_preference.Elevation">
                <MudExpansionPanel Text="What are Share Accounts?">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle2">Understanding Member Share Ownership</MudText>
                        <MudText Typo="Typo.body2">
                            Share accounts track the ownership stake each member holds in the microfinance institution.
                            Members purchase shares to become part-owners and may receive dividends based on profitability.
                        </MudText>
                        
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Key Information:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                • Each member can have one share account per share product<br/>
                                • Shares can be purchased over time (incremental)<br/>
                                • Share value = Number of Shares × Current Price<br/>
                                • Minimum shares are typically required for membership
                            </MudText>
                        </div>

                        <MudAlert Severity="Severity.Info" Dense="true">
                            <strong>Tip:</strong> Members who purchase minimum shares gain access to loan products.
                        </MudAlert>
                    </MudStack>
                </MudExpansionPanel>

                <MudExpansionPanel Text="Share Transactions">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle2">Types of Share Transactions</MudText>
                        
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Purchase:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                • Member buys additional shares<br/>
                                • Payment at current share price<br/>
                                • Increases member's ownership stake<br/>
                                • May improve loan eligibility
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Redemption:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                • MFI buys back shares from member<br/>
                                • Usually at nominal or current value<br/>
                                • Cannot go below minimum required<br/>
                                • Subject to capital adequacy rules
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Transfer:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                • Move shares between members<br/>
                                • Requires both parties' consent<br/>
                                • May require board approval<br/>
                                • Transfer fees may apply
                            </MudText>
                        </div>
                    </MudStack>
                </MudExpansionPanel>

                <MudExpansionPanel Text="Account Lifecycle">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle2">From Opening to Closure</MudText>
                        
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>1. Account Opening:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                • Created when member joins<br/>
                                • Initial shares purchased<br/>
                                • Certificate issued (optional)
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>2. Active Operations:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                • Additional purchases<br/>
                                • Dividend receipts<br/>
                                • Value appreciation
                            </MudText>
                        </div>

                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>3. Account Closure:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                • All shares redeemed<br/>
                                • Outstanding loans cleared<br/>
                                • Membership may be terminated
                            </MudText>
                        </div>
                    </MudStack>
                </MudExpansionPanel>

                <MudExpansionPanel Text="Dividends">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle2">How Dividends Work</MudText>
                        <MudText Typo="Typo.body2">
                            Shareholders receive a portion of the MFI's profits based on their shareholding.
                        </MudText>
                        
                        <div>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                <strong>Dividend Process:</strong>
                            </MudText>
                            <MudText Typo="Typo.caption">
                                1. Board proposes dividend rate<br/>
                                2. AGM approves dividend<br/>
                                3. Calculate each member's share<br/>
                                4. Credit to savings or pay cash
                            </MudText>
                        </div>

                        <MudAlert Severity="Severity.Warning" Dense="true">
                            <strong>Note:</strong> Dividends are only paid if the share product has PaysDividends enabled.
                        </MudAlert>
                    </MudStack>
                </MudExpansionPanel>

                <MudExpansionPanel Text="Opening a Share Account">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle2">Step-by-Step Guide</MudText>
                        
                        <ol>
                            <li><MudText Typo="Typo.caption">Click the <strong>+</strong> button to open the form</MudText></li>
                            <li><MudText Typo="Typo.caption">Account number is auto-generated or enter custom</MudText></li>
                            <li><MudText Typo="Typo.caption">Select the <strong>Member</strong> who will own the shares</MudText></li>
                            <li><MudText Typo="Typo.caption">Select the <strong>Share Product</strong></MudText></li>
                            <li><MudText Typo="Typo.caption">Enter the <strong>Number of Shares</strong> to purchase</MudText></li>
                            <li><MudText Typo="Typo.caption">Click <strong>Save</strong> to create the account</MudText></li>
                        </ol>

                        <MudAlert Severity="Severity.Info" Dense="true">
                            <strong>Next:</strong> Collect payment for shares and issue share certificate if applicable.
                        </MudAlert>
                    </MudStack>
                </MudExpansionPanel>
            </MudExpansionPanels>
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close" Color="Color.Primary">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] 
    private IMudDialogInstance MudDialog { get; set; } = null!;

    private ClientPreference _preference = new();

    protected override async Task OnInitializedAsync()
    {
        if (await ClientPreferences.GetPreference() is ClientPreference preference)
        {
            _preference = preference;
        }
    }

    private void Close() => MudDialog.Close();
}

# Version Notification System - Architecture Diagram

## System Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                         Blazor WebAssembly Client                    │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    │
        ┌───────────────────────────┼───────────────────────────┐
        │                           │                           │
        ▼                           ▼                           ▼
┌──────────────┐          ┌──────────────────┐       ┌─────────────────┐
│   BaseLayout │          │  VersionNotif    │       │  VersionCheck   │
│   Component  │────────► │   Component      │──────►│    Service      │
└──────────────┘          │   (Razor)        │       │   (C#)          │
                          └──────────────────┘       └─────────────────┘
                                    │                           │
                                    │ Display UI                │ JS Interop
                                    │                           │
                                    ▼                           ▼
                          ┌──────────────────┐       ┌─────────────────┐
                          │   MudBlazor UI   │       │  versionCheck.js│
                          │   Components     │       │   (JavaScript)  │
                          └──────────────────┘       └─────────────────┘
                                                               │
                                    ┌──────────────────────────┤
                                    │                          │
                                    ▼                          ▼
                          ┌──────────────────┐       ┌─────────────────┐
                          │   localStorage   │       │  HTTP Fetch     │
                          │   (app-version)  │       │  (version.json) │
                          └──────────────────┘       └─────────────────┘
                                                               │
                                                               │
                                                               ▼
                                                     ┌─────────────────┐
                                                     │  Web Server     │
                                                     │  wwwroot/       │
                                                     │  version.json   │
                                                     └─────────────────┘
```

## Component Interaction Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         Application Startup                              │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  Program.cs      │
                          │  Register Service│
                          └──────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  BaseLayout      │
                          │  Loads           │
                          └──────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  VersionNotif    │
                          │  Component Init  │
                          └──────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
        ┌──────────────────────┐       ┌──────────────────────┐
        │  Initialize Check    │       │  Start Timer         │
        │  (on load)           │       │  (periodic checks)   │
        └──────────────────────┘       └──────────────────────┘
                    │                               │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  Version Check   │
                          │  Service Call    │
                          └──────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
        ┌──────────────────────┐       ┌──────────────────────┐
        │  Get Local Version   │       │  Fetch Server Ver    │
        │  (localStorage)      │       │  (HTTP GET)          │
        └──────────────────────┘       └──────────────────────┘
                    │                               │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  Compare         │
                          │  Versions        │
                          └──────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
        ┌──────────────────────┐       ┌──────────────────────┐
        │  Same Version        │       │  New Version         │
        │  (No Action)         │       │  (Show Notification) │
        └──────────────────────┘       └──────────────────────┘
```

## Update Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      User Sees Notification                              │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
        ┌──────────────────────┐       ┌──────────────────────┐
        │  User Clicks         │       │  User Clicks         │
        │  "Later"             │       │  "Update Now"        │
        └──────────────────────┘       └──────────────────────┘
                    │                               │
                    ▼                               ▼
        ┌──────────────────────┐       ┌──────────────────────┐
        │  Hide Notification   │       │  Show "Updating..."  │
        │  Wait for Next Check │       │  State               │
        └──────────────────────┘       └──────────────────────┘
                    │                               │
                    ▼                               ▼
        ┌──────────────────────┐       ┌──────────────────────┐
        │  Continue Using      │       │  Update localStorage │
        │  Application         │       │  with New Version    │
        └──────────────────────┘       └──────────────────────┘
                                                    │
                                                    ▼
                                        ┌──────────────────────┐
                                        │  Clear Service       │
                                        │  Worker Caches       │
                                        └──────────────────────┘
                                                    │
                                                    ▼
                                        ┌──────────────────────┐
                                        │  Hard Reload Page    │
                                        │  (Force Download)    │
                                        └──────────────────────┘
                                                    │
                                                    ▼
                                        ┌──────────────────────┐
                                        │  Application         │
                                        │  Restarts            │
                                        └──────────────────────┘
                                                    │
                                                    ▼
                                        ┌──────────────────────┐
                                        │  Fresh Files         │
                                        │  Downloaded          │
                                        └──────────────────────┘
                                                    │
                                                    ▼
                                        ┌──────────────────────┐
                                        │  New Version         │
                                        │  Running             │
                                        └──────────────────────┘
```

## Data Flow Diagram

```
┌────────────────────────────────────────────────────────────────────┐
│                            Client Side                              │
├────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   ┌─────────────────┐                                              │
│   │ VersionNotif    │                                              │
│   │ Component       │                                              │
│   └────────┬────────┘                                              │
│            │ 1. Request Check                                      │
│            ▼                                                        │
│   ┌─────────────────┐                                              │
│   │ VersionCheck    │                                              │
│   │ Service (C#)    │                                              │
│   └────────┬────────┘                                              │
│            │ 2. JS Interop Call                                    │
│            ▼                                                        │
│   ┌─────────────────┐         ┌──────────────┐                    │
│   │ versionCheck.js │◄───────►│ localStorage │                    │
│   │ (JavaScript)    │         │ app-version  │                    │
│   └────────┬────────┘         └──────────────┘                    │
│            │ 3. HTTP GET                                           │
│            │                                                        │
└────────────┼────────────────────────────────────────────────────────┘
             │
             │ 4. Fetch version.json
             ▼
┌────────────────────────────────────────────────────────────────────┐
│                            Server Side                              │
├────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   ┌─────────────────┐                                              │
│   │ Web Server      │                                              │
│   │ (nginx/IIS)     │                                              │
│   └────────┬────────┘                                              │
│            │ 5. Serve File                                         │
│            ▼                                                        │
│   ┌─────────────────┐                                              │
│   │ wwwroot/        │                                              │
│   │ version.json    │                                              │
│   │ {               │                                              │
│   │   version: 1.0.1│                                              │
│   │ }               │                                              │
│   └─────────────────┘                                              │
│                                                                     │
└────────────────────────────────────────────────────────────────────┘
             │
             │ 6. Return JSON
             ▼
┌────────────────────────────────────────────────────────────────────┐
│                            Client Side                              │
├────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   ┌─────────────────┐                                              │
│   │ versionCheck.js │                                              │
│   │ Receives:       │                                              │
│   │ server: "1.0.1" │                                              │
│   │ local: "1.0.0"  │                                              │
│   └────────┬────────┘                                              │
│            │ 7. Return Result                                      │
│            ▼                                                        │
│   ┌─────────────────┐                                              │
│   │ VersionCheck    │                                              │
│   │ Service         │                                              │
│   │ IsNewVersion=true                                              │
│   └────────┬────────┘                                              │
│            │ 8. State Update                                       │
│            ▼                                                        │
│   ┌─────────────────┐                                              │
│   │ VersionNotif    │                                              │
│   │ Component       │                                              │
│   │ Shows Banner    │                                              │
│   └─────────────────┘                                              │
│                                                                     │
└────────────────────────────────────────────────────────────────────┘
```

## Deployment Pipeline

```
┌────────────────────────────────────────────────────────────────────┐
│                        Developer/CI System                          │
└────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  Git Push/Tag    │
                          │  (Trigger)       │
                          └──────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  CI/CD Pipeline  │
                          │  Starts          │
                          └──────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  Checkout Code   │
                          └──────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  Run             │
                          │  update-version.sh│
                          │  -v 1.0.1        │
                          └──────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  version.json    │
                          │  Updated         │
                          └──────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  dotnet restore  │
                          └──────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  dotnet build    │
                          └──────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  dotnet publish  │
                          └──────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  Deploy to       │
                          │  Server/CDN      │
                          └──────────────────┘
                                    │
                                    ▼
┌────────────────────────────────────────────────────────────────────┐
│                            Production                               │
└────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  New version.json│
                          │  Available       │
                          └──────────────────┘
                                    │
                                    ▼
                          ┌──────────────────┐
                          │  Connected       │
                          │  Clients Detect  │
                          │  Update          │
                          └──────────────────┘
```

## State Diagram

```
                    ┌─────────────────┐
                    │  Initial State  │
                    │  (No Version)   │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │  Check Version  │
                    │  on Init        │
                    └────────┬────────┘
                             │
                ┌────────────┼────────────┐
                │                         │
                ▼                         ▼
     ┌──────────────────┐      ┌──────────────────┐
     │  First Visit     │      │  Has Stored Ver  │
     │  Store Version   │      │  Compare         │
     └──────────────────┘      └────────┬─────────┘
                │                       │
                │              ┌────────┴────────┐
                │              │                 │
                │              ▼                 ▼
                │   ┌────────────────┐  ┌─────────────────┐
                │   │  Same Version  │  │  New Version    │
                │   │  No Action     │  │  Show Banner    │
                │   └────────────────┘  └────────┬────────┘
                │              │                 │
                └──────────────┼─────────────────┘
                               │
                               ▼
                    ┌─────────────────┐
                    │  Normal State   │
                    │  (Monitoring)   │
                    └────────┬────────┘
                             │
                             │ Timer Tick (5 min)
                             │
                             ▼
                    ┌─────────────────┐
                    │  Periodic Check │
                    └────────┬────────┘
                             │
                ┌────────────┼────────────┐
                │                         │
                ▼                         ▼
     ┌──────────────────┐      ┌──────────────────┐
     │  No Change       │      │  New Version     │
     │  Continue        │      │  Detected        │
     └──────────────────┘      └────────┬─────────┘
                │                       │
                │                       ▼
                │              ┌──────────────────┐
                │              │  Notification    │
                │              │  State           │
                │              └────────┬─────────┘
                │                       │
                │              ┌────────┴────────┐
                │              │                 │
                │              ▼                 ▼
                │   ┌────────────────┐  ┌─────────────────┐
                │   │  User Clicks   │  │  User Clicks    │
                │   │  "Later"       │  │  "Update Now"   │
                │   └────────┬───────┘  └────────┬────────┘
                │            │                   │
                └────────────┤                   ▼
                             │          ┌─────────────────┐
                             │          │  Updating State │
                             │          └────────┬────────┘
                             │                   │
                             │                   ▼
                             │          ┌─────────────────┐
                             │          │  Clear Cache &  │
                             │          │  Reload         │
                             │          └────────┬────────┘
                             │                   │
                             │                   ▼
                             │          ┌─────────────────┐
                             └─────────►│  Normal State   │
                                        │  (New Version)  │
                                        └─────────────────┘
```

## Technology Stack

```
┌────────────────────────────────────────────────────────────┐
│                      Frontend Layer                         │
├────────────────────────────────────────────────────────────┤
│  • Blazor WebAssembly (.NET 9.0)                           │
│  • MudBlazor UI Components                                 │
│  • C# Razor Components                                     │
└────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌────────────────────────────────────────────────────────────┐
│                      Service Layer                          │
├────────────────────────────────────────────────────────────┤
│  • IVersionCheckService (Interface)                        │
│  • VersionCheckService (Implementation)                    │
│  • Dependency Injection                                    │
│  • Async/Await Pattern                                     │
└────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌────────────────────────────────────────────────────────────┐
│                      JavaScript Layer                       │
├────────────────────────────────────────────────────────────┤
│  • JavaScript Interop (JSRuntime)                          │
│  • versionCheck.js Module                                  │
│  • Fetch API                                               │
│  • Service Worker API                                      │
└────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌────────────────────────────────────────────────────────────┐
│                      Storage Layer                          │
├────────────────────────────────────────────────────────────┤
│  • localStorage (Browser)                                  │
│  • Service Worker Caches                                   │
└────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌────────────────────────────────────────────────────────────┐
│                      Data Layer                             │
├────────────────────────────────────────────────────────────┤
│  • version.json (Static JSON File)                         │
│  • Web Server (nginx/IIS/CDN)                              │
└────────────────────────────────────────────────────────────┘
```

---

**Legend:**
- `─` Horizontal flow
- `│` Vertical flow
- `▼` Process direction
- `┌─┐` Component boundary
- `└─┘` Component boundary


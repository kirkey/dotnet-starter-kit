import{a as Fe}from"./chunk-XILEJOTT.js";import{a as ee,b as te,c as ie,d as ne}from"./chunk-WHTXMG5H.js";import{a as T,d as ye,e as Ee,f as Te}from"./chunk-SGCXT6IT.js";import{a as j}from"./chunk-4IQRVVSS.js";import{a as De,b as Oe}from"./chunk-IAULPURU.js";import{a as pe,b as _e,c as ue,d as fe,e as ge,f as Ce,g as he,h as xe,i as be,j as Pe,k as Me,l as Se}from"./chunk-JDCNVKL3.js";import{b as we,c as ve}from"./chunk-IMNAVXVZ.js";import{a as Re}from"./chunk-MEZ4YZNT.js";import"./chunk-R6QGXIMR.js";import{a as ce}from"./chunk-XZK5SHMD.js";import{b as le}from"./chunk-BK3PSTX2.js";import{b as oe,e as ae,i as re,j as se,k as me,l as de}from"./chunk-FCCRYPII.js";import{b as Q,g as X,j as Y,p as Z}from"./chunk-BLGZ2ZXV.js";import{a as q,b as G}from"./chunk-36HQY7RT.js";import"./chunk-7FXRJWRW.js";import"./chunk-OEMMV5VK.js";import{a as J,d as K}from"./chunk-U2EMCCYP.js";import{a as z,c as A,d as $,h as U}from"./chunk-VLA6YYWX.js";import"./chunk-NW6BZQUB.js";import"./chunk-CARY4E7O.js";import{$b as y,Ab as V,Bb as o,Cb as a,Db as f,Eb as P,Fb as M,Hb as S,Kb as N,Mb as m,Sc as W,Wa as s,Wb as l,Yb as w,Zb as H,_b as R,ac as E,cc as B,ea as c,fb as u,ia as F,mb as d,qa as x,qb as k,ra as b,rb as p,tb as v,ub as I,wb as C,xc as g,zb as L}from"./chunk-ENBBOSSX.js";import{a as D,b as O}from"./chunk-4CLCTAJ7.js";var Ie=(t,r)=>r.resource;function Le(t,r){t&1&&(o(0,"div",2),f(1,"mat-spinner",3),a())}function Ve(t,r){t&1&&f(0,"mat-spinner",12)}function Ne(t,r){if(t&1){let e=S();o(0,"button",11),N("click",function(){x(e);let n=m(2);return b(n.savePermissions())}),d(1,Ve,1,0,"mat-spinner",12),o(2,"mat-icon"),l(3,"save"),a(),l(4," Update Permissions "),a()}if(t&2){let e=m(2);p("disabled",e.isSaving()),s(),C(e.isSaving()?1:-1)}}function He(t,r){if(t&1){let e=S();o(0,"mat-form-field",9)(1,"mat-label"),l(2,"Search Permissions"),a(),o(3,"input",13),E("ngModelChange",function(n){x(e);let _=m(2);return y(_.searchString,n)||(_.searchString=n),b(n)}),a(),o(4,"mat-icon",14),l(5,"search"),a()()}if(t&2){let e=m(2);s(3),R("ngModel",e.searchString)}}function Be(t,r){if(t&1&&(o(0,"span",26),l(1),o(2,"span",27),l(3),a()()),t&2){let e=m().$implicit,i=m(2);s(),w(" ",e.resource," "),s(),I(i.getBadgeClass(e)),s(),H(" ",i.getSelectedCount(e),"/",e.permissions.length," ")}}function We(t,r){t&1&&(o(0,"th",28),l(1,"Permission Name"),a())}function ze(t,r){if(t&1&&(o(0,"td",29)(1,"span"),l(2),a()()),t&2){let e=r.$implicit,i=m(3);s(),v("highlight",i.shouldHighlight(e.name)),s(),w(" ",e.name," ")}}function Ae(t,r){t&1&&(o(0,"th",28),l(1,"Description"),a())}function $e(t,r){if(t&1&&(o(0,"td",29)(1,"span"),l(2),a()()),t&2){let e=r.$implicit,i=m(3);s(),v("highlight",i.shouldHighlight(e.description)),s(),w(" ",e.description," ")}}function Ue(t,r){t&1&&(o(0,"th",28),l(1,"Status"),a())}function je(t,r){if(t&1){let e=S();o(0,"td",29)(1,"mat-checkbox",30),E("ngModelChange",function(n){let _=x(e).$implicit;return y(_.enabled,n)||(_.enabled=n),b(n)}),a()()}if(t&2){let e=r.$implicit,i=m(3);s(),R("ngModel",e.enabled),p("disabled",!i.canEdit())}}function qe(t,r){t&1&&f(0,"tr",31)}function Ge(t,r){t&1&&f(0,"tr",32)}function Je(t,r){if(t&1&&(o(0,"tr",33)(1,"td",34)(2,"div",35)(3,"mat-icon"),l(4,"search_off"),a(),o(5,"p"),l(6,"No permissions found"),a()()()()),t&2){let e=m(3);s(),k("colspan",e.displayedColumns.length)}}function Ke(t,r){if(t&1&&(o(0,"mat-tab"),d(1,Be,4,5,"ng-template",15),o(2,"div",16)(3,"table",17),P(4,18),d(5,We,2,0,"th",19)(6,ze,3,3,"td",20),M(),P(7,21),d(8,Ae,2,0,"th",19)(9,$e,3,3,"td",20),M(),P(10,22),d(11,Ue,2,0,"th",19)(12,je,2,2,"td",20),M(),d(13,qe,1,0,"tr",23)(14,Ge,1,0,"tr",24)(15,Je,7,1,"tr",25),a()()()),t&2){let e=r.$implicit,i=m(2);s(3),p("dataSource",i.filterPermissions(e.permissions)),s(10),p("matHeaderRowDef",i.displayedColumns),s(),p("matRowDefColumns",i.displayedColumns)}}function Qe(t,r){if(t&1&&(o(0,"div",4)(1,"div",5)(2,"button",6)(3,"mat-icon"),l(4,"arrow_back"),a(),l(5," Back "),a(),d(6,Ne,5,2,"button",7),a(),o(7,"div",8),d(8,He,6,1,"mat-form-field",9),a()(),o(9,"mat-tab-group",10),L(10,Ke,16,3,"mat-tab",null,Ie),a()),t&2){let e=m();s(6),C(e.canEdit()?6:-1),s(2),C(e.canSearch()?8:-1),s(2),V(e.groupedPermissions())}}var Et=(()=>{class t{route=c(z);router=c(A);notification=c(Re);roleService=c(Fe);permissionService=c(Te);authService=c(j);roleId=u("");roleName=u("");allPermissions=u([]);isLoading=u(!0);isSaving=u(!1);searchString="";displayedColumns=["name","description","enabled"];title=g(()=>`${this.roleName()} Permissions`);description=g(()=>`Manage ${this.roleName()} Role Permissions`);canEdit=g(()=>this.permissionService.canUpdate(T.RoleClaims));canSearch=g(()=>this.permissionService.canView(T.RoleClaims));groupedPermissions=g(()=>{let e=this.allPermissions();return Ee(e)});ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&(this.roleId.set(e),this.loadRolePermissions(e))}loadRolePermissions(e){this.isLoading.set(!0),this.roleService.getRolePermissions(e).subscribe({next:i=>{this.roleName.set(i.roleName||"Role"),this.initializePermissions(i.permissions||[]),this.isLoading.set(!1)},error:()=>{this.roleName.set("Admin"),this.initializePermissions(["Permissions.Users.View","Permissions.Users.Create","Permissions.Roles.View"]),this.isLoading.set(!1)}})}initializePermissions(e){let i=this.authService.getTenant(),n=ye(),ke=(i==="root"?n:n.filter(h=>!h.isRoot)).map(h=>O(D({},h),{enabled:e.includes(h.name)}));this.allPermissions.set(ke)}filterPermissions(e){let i=this.searchString.toLowerCase();return i?e.filter(n=>n.name.toLowerCase().includes(i)||n.description.toLowerCase().includes(i)):e}shouldHighlight(e){return!e||!this.searchString?!1:e.toLowerCase().includes(this.searchString.toLowerCase())}getSelectedCount(e){return e.permissions.filter(i=>i.enabled).length}getBadgeClass(e){let i=this.getSelectedCount(e),n=e.permissions.length;return i===0?"none":i===n?"all":"partial"}savePermissions(){this.isSaving.set(!0);let e=this.allPermissions().filter(n=>n.enabled).map(n=>n.name),i={roleId:this.roleId(),permissions:e};this.roleService.updateRolePermissions(this.roleId(),i).subscribe({next:()=>{this.notification.success("Permissions updated successfully"),this.router.navigate(["/identity/roles"]),this.isSaving.set(!1)},error:()=>{this.notification.error("Failed to update permissions"),this.isSaving.set(!1)}})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=F({type:t,selectors:[["app-role-permissions"]],standalone:!0,features:[B],decls:4,vars:3,consts:[[1,"permissions-container"],["icon","security",3,"title","subtitle"],[1,"loading"],["diameter","48"],[1,"toolbar"],[1,"toolbar-actions"],["mat-stroked-button","","routerLink","/identity/roles"],["mat-raised-button","","color","primary",3,"disabled"],[1,"search-container"],["appearance","outline",1,"search-field"],["animationDuration","0ms",1,"permissions-tabs"],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","20"],["matInput","","placeholder","Search for permissions...",3,"ngModelChange","ngModel"],["matPrefix",""],["mat-tab-label",""],[1,"tab-content"],["mat-table","",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["matColumnDef","enabled"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[1,"tab-label"],[1,"tab-badge"],["mat-header-cell",""],["mat-cell",""],["color","primary",3,"ngModelChange","ngModel","disabled"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell","no-data-cell"],[1,"no-data"]],template:function(i,n){i&1&&(o(0,"div",0),f(1,"app-page-header",1),d(2,Le,2,0,"div",2)(3,Qe,12,2),a()),i&2&&(s(),p("title",n.title())("subtitle",n.description()),s(),C(n.isLoading()?2:3))},dependencies:[W,U,$,Z,Q,X,Y,ne,ee,te,ie,Se,pe,ue,he,fe,_e,xe,ge,Ce,be,Pe,Me,K,J,G,q,de,me,Oe,De,se,re,oe,ae,ve,we,le,ce],styles:[".permissions-container[_ngcontent-%COMP%]{padding:24px}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:400px}.toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;gap:16px;flex-wrap:wrap}.toolbar-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.search-container[_ngcontent-%COMP%]{flex:1;max-width:300px}.search-field[_ngcontent-%COMP%]{width:100%}.permissions-tabs[_ngcontent-%COMP%]{background:var(--surface-color);border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #0000001a}.tab-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.tab-badge[_ngcontent-%COMP%]{font-size:11px;padding:2px 8px;border-radius:12px;font-weight:500}.tab-badge.none[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.tab-badge.partial[_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.tab-badge.all[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.tab-content[_ngcontent-%COMP%]{padding:16px}table[_ngcontent-%COMP%]{width:100%}.highlight[_ngcontent-%COMP%]{background:#fef08a;padding:2px 4px;border-radius:2px}.no-data-cell[_ngcontent-%COMP%]{text-align:center;padding:48px!important}.no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:8px;color:var(--text-secondary)}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}@media (max-width: 600px){.toolbar[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.search-container[_ngcontent-%COMP%]{max-width:none}}"]})}return t})();export{Et as RolePermissionsComponent};

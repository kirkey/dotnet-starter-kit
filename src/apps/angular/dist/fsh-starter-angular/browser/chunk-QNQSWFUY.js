import{a as E,f as _e}from"./chunk-SGCXT6IT.js";import"./chunk-4IQRVVSS.js";import{a as Ce}from"./chunk-BSR2XVU6.js";import{a as fe,b as he}from"./chunk-IAULPURU.js";import{a as Z,b as ee,c as te,d as ie,e as ne,f as oe,g as ae,h as re,i as se,j as le,k as me,l as de}from"./chunk-JDCNVKL3.js";import{b as ce,c as pe}from"./chunk-IMNAVXVZ.js";import{a as ue}from"./chunk-MEZ4YZNT.js";import"./chunk-R6QGXIMR.js";import{a as Y}from"./chunk-XZK5SHMD.js";import{b as z,e as J,i as G,j as K,k as Q,l as X}from"./chunk-FCCRYPII.js";import{b as j,g as A,j as $,p as q}from"./chunk-BLGZ2ZXV.js";import{a as F,b as I}from"./chunk-36HQY7RT.js";import"./chunk-7FXRJWRW.js";import"./chunk-OEMMV5VK.js";import{a as B,d as W}from"./chunk-U2EMCCYP.js";import{a as L,c as k,d as H,h as V}from"./chunk-VLA6YYWX.js";import"./chunk-NW6BZQUB.js";import"./chunk-CARY4E7O.js";import{$b as y,Bb as o,Cb as n,Db as u,Eb as M,Fb as R,Hb as S,Kb as N,Mb as m,Sc as O,Wa as r,Wb as s,Yb as w,_b as v,ac as U,cc as T,ea as p,fb as h,ia as P,mb as d,qa as g,qb as D,ra as x,rb as c,tb as b,wb as C,xc as _}from"./chunk-ENBBOSSX.js";import"./chunk-4CLCTAJ7.js";function ge(t,a){t&1&&(o(0,"div",2),u(1,"mat-spinner",3),n())}function xe(t,a){t&1&&u(0,"mat-spinner",21)}function Me(t,a){if(t&1){let e=S();o(0,"button",20),N("click",function(){g(e);let l=m(2);return x(l.saveRoles())}),d(1,xe,1,0,"mat-spinner",21),o(2,"mat-icon"),s(3,"save"),n(),s(4," Update "),n()}if(t&2){let e=m(2);c("disabled",e.isSaving()),r(),C(e.isSaving()?1:-1)}}function Re(t,a){if(t&1){let e=S();o(0,"mat-form-field",9)(1,"mat-label"),s(2,"Search Roles"),n(),o(3,"input",22),U("ngModelChange",function(l){g(e);let f=m(2);return y(f.searchString,l)||(f.searchString=l),x(l)}),n(),o(4,"mat-icon",23),s(5,"search"),n()()}if(t&2){let e=m(2);r(3),v("ngModel",e.searchString)}}function Se(t,a){t&1&&(o(0,"th",24),s(1,"Role Name"),n())}function be(t,a){if(t&1&&(o(0,"td",25)(1,"span"),s(2),n()()),t&2){let e=a.$implicit,i=m(2);r(),b("highlight",i.shouldHighlight(e.roleName)),r(),w(" ",e.roleName," ")}}function we(t,a){t&1&&(o(0,"th",24),s(1,"Description"),n())}function ve(t,a){if(t&1&&(o(0,"td",25)(1,"span"),s(2),n()()),t&2){let e=a.$implicit,i=m(2);r(),b("highlight",i.shouldHighlight(e.description)),r(),w(" ",e.description||"-"," ")}}function ye(t,a){t&1&&(o(0,"th",24),s(1,"Status"),n())}function Ue(t,a){if(t&1){let e=S();o(0,"td",25)(1,"mat-checkbox",26),U("ngModelChange",function(l){let f=g(e).$implicit;return y(f.enabled,l)||(f.enabled=l),x(l)}),n()()}if(t&2){let e=a.$implicit,i=m(2);r(),v("ngModel",e.enabled),c("disabled",!i.canEdit())}}function Ee(t,a){t&1&&u(0,"tr",27)}function Pe(t,a){t&1&&u(0,"tr",28)}function De(t,a){if(t&1&&(o(0,"tr",29)(1,"td",30)(2,"div",31)(3,"mat-icon"),s(4,"search_off"),n(),o(5,"p"),s(6,"No roles found"),n()()()()),t&2){let e=m(2);r(),D("colspan",e.displayedColumns.length)}}function Ne(t,a){if(t&1&&(o(0,"div",4)(1,"div",5)(2,"button",6)(3,"mat-icon"),s(4,"arrow_back"),n(),s(5," Back "),n(),d(6,Me,5,2,"button",7),n(),o(7,"div",8),d(8,Re,6,1,"mat-form-field",9),n()(),o(9,"div",10)(10,"table",11),M(11,12),d(12,Se,2,0,"th",13)(13,be,3,3,"td",14),R(),M(14,15),d(15,we,2,0,"th",13)(16,ve,3,3,"td",14),R(),M(17,16),d(18,ye,2,0,"th",13)(19,Ue,2,2,"td",14),R(),d(20,Ee,1,0,"tr",17)(21,Pe,1,0,"tr",18)(22,De,7,1,"tr",19),n()()),t&2){let e=m();r(6),C(e.canEdit()?6:-1),r(2),C(e.canSearch()?8:-1),r(2),c("dataSource",e.filteredRoles()),r(10),c("matHeaderRowDef",e.displayedColumns),r(),c("matRowDefColumns",e.displayedColumns)}}var at=(()=>{class t{route=p(L);router=p(k);notification=p(ue);userService=p(Ce);permissionService=p(_e);user=h(null);userRoles=h([]);isLoading=h(!0);isSaving=h(!1);searchString="";displayedColumns=["roleName","description","enabled"];title=_(()=>{let e=this.user();return e?`${e.firstName} ${e.lastName}'s Roles`:"User Roles"});description=_(()=>{let e=this.user();return e?`Manage ${e.firstName} ${e.lastName}'s Roles`:"Manage user roles"});canEdit=_(()=>this.permissionService.canUpdate(E.Users));canSearch=_(()=>this.permissionService.canView(E.UserRoles));filteredRoles=_(()=>{let e=this.searchString.toLowerCase();return e?this.userRoles().filter(i=>i.roleName?.toLowerCase().includes(e)||i.description?.toLowerCase().includes(e)):this.userRoles()});ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&this.loadData(e)}loadData(e){this.isLoading.set(!0),this.userService.getUser(e).subscribe({next:i=>{this.user.set(i),this.loadUserRoles(e)},error:()=>{this.user.set({id:e,firstName:"John",lastName:"Doe",email:"john.doe@example.com",userName:"johndoe",isActive:!0}),this.loadUserRoles(e)}})}loadUserRoles(e){this.userService.getUserRoles(e).subscribe({next:i=>{this.userRoles.set(i),this.isLoading.set(!1)},error:()=>{this.userRoles.set([{roleId:"1",roleName:"Admin",description:"Full system access",enabled:!0},{roleId:"2",roleName:"Basic",description:"Basic user access",enabled:!1},{roleId:"3",roleName:"Manager",description:"Management access",enabled:!0}]),this.isLoading.set(!1)}})}shouldHighlight(e){return!e||!this.searchString?!1:e.toLowerCase().includes(this.searchString.toLowerCase())}saveRoles(){let e=this.route.snapshot.paramMap.get("id");if(!e)return;this.isSaving.set(!0);let i={userRoles:this.userRoles()};this.userService.assignRolesToUser(e,i).subscribe({next:()=>{this.notification.success("User roles updated"),this.router.navigate(["/identity/users"]),this.isSaving.set(!1)},error:()=>{this.notification.error("Failed to update user roles"),this.isSaving.set(!1)}})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=P({type:t,selectors:[["app-user-roles"]],standalone:!0,features:[T],decls:4,vars:3,consts:[[1,"user-roles-container"],["icon","admin_panel_settings",3,"title","subtitle"],[1,"loading"],["diameter","48"],[1,"toolbar"],[1,"toolbar-actions"],["mat-stroked-button","","routerLink","/identity/users"],["mat-raised-button","","color","primary",3,"disabled"],[1,"search-container"],["appearance","outline",1,"search-field"],[1,"table-container"],["mat-table","",3,"dataSource"],["matColumnDef","roleName"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["matColumnDef","enabled"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","20"],["matInput","","placeholder","Search for user roles...",3,"ngModelChange","ngModel"],["matPrefix",""],["mat-header-cell",""],["mat-cell",""],["color","primary",3,"ngModelChange","ngModel","disabled"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell","no-data-cell"],[1,"no-data"]],template:function(i,l){i&1&&(o(0,"div",0),u(1,"app-page-header",1),d(2,ge,2,0,"div",2)(3,Ne,23,5),n()),i&2&&(r(),c("title",l.title())("subtitle",l.description()),r(),C(l.isLoading()?2:3))},dependencies:[O,V,H,q,j,A,$,de,Z,te,ae,ie,ee,re,ne,oe,se,le,me,W,B,I,F,X,Q,he,fe,K,G,z,J,pe,ce,Y],styles:[".user-roles-container[_ngcontent-%COMP%]{padding:24px}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:400px}.toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;gap:16px;flex-wrap:wrap}.toolbar-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.search-container[_ngcontent-%COMP%]{flex:1;max-width:300px}.search-field[_ngcontent-%COMP%]{width:100%}.table-container[_ngcontent-%COMP%]{background:var(--surface-color);border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #0000001a}table[_ngcontent-%COMP%]{width:100%}.highlight[_ngcontent-%COMP%]{background:#fef08a;padding:2px 4px;border-radius:2px}.no-data-cell[_ngcontent-%COMP%]{text-align:center;padding:48px!important}.no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:8px;color:var(--text-secondary)}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}@media (max-width: 600px){.toolbar[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.search-container[_ngcontent-%COMP%]{max-width:none}}"]})}return t})();export{at as UserRolesComponent};

import{a as P}from"./chunk-4IQRVVSS.js";import{a as n}from"./chunk-7FXRJWRW.js";import{a as h}from"./chunk-NW6BZQUB.js";import{D as p,_ as u,ea as a,fb as l,m}from"./chunk-ENBBOSSX.js";var d={Tenants:"Tenants",Analytics:"Analytics",Dashboard:"Dashboard",Hangfire:"Hangfire",Users:"Users",UserRoles:"UserRoles",Roles:"Roles",RoleClaims:"RoleClaims",AuditTrails:"AuditTrails",Brands:"Brands",Products:"Products",Todos:"Todos",Accounting:"Accounting",Store:"Store",Warehouse:"Warehouse",Messaging:"Messaging",Employees:"Employees",Attendance:"Attendance",Timesheets:"Timesheets",Leaves:"Leaves",Payroll:"Payroll",Benefits:"Benefits",Taxes:"Taxes",Organization:"Organization"},i={View:"View",Search:"Search",Create:"Create",Update:"Update",Delete:"Delete",Import:"Import",Export:"Export",Generate:"Generate",Clean:"Clean",UpgradeSubscription:"UpgradeSubscription",Regularize:"Regularize",Terminate:"Terminate",Assign:"Assign",Manage:"Manage",Approve:"Approve",Reject:"Reject",Submit:"Submit",Process:"Process",Complete:"Complete",Cancel:"Cancel",Void:"Void",Post:"Post",Send:"Send",Receive:"Receive",MarkAsPaid:"MarkAsPaid",Accrue:"Accrue",Acknowledge:"Acknowledge"},g={Admin:"Admin",Basic:"Basic"},f=[g.Admin,g.Basic];function x(r){return f.includes(r)}function R(r,o){return`Permissions.${o}.${r}`}function A(){let r=[],o=Object.values(d),e=[i.View,i.Create,i.Update,i.Delete,i.Search,i.Export];return o.forEach(s=>{e.forEach(t=>{r.push({name:R(t,s),description:`${t} ${s}`,action:t,resource:s,isBasic:t===i.View,isRoot:s===d.Tenants})})}),r}function v(r){let o=new Map;return r.forEach(e=>{let s=o.get(e.resource)||[];s.push(e),o.set(e.resource,s)}),Array.from(o.entries()).map(([e,s])=>({resource:e,permissions:s}))}var D=(()=>{class r{http=a(h);authService=a(P);_userPermissions=l([]);userPermissions=this._userPermissions.asReadonly();permissionCache=new Map;constructor(){this.loadUserPermissions()}loadUserPermissions(){if(!this.authService.isAuthenticated()){this._userPermissions.set([]);return}this.http.get(`${n.apiUrl}/personal/permissions`).pipe(p(()=>m(this.getPermissionsFromToken()))).subscribe(e=>{this._userPermissions.set(e),this.permissionCache.clear()})}getPermissionsFromToken(){let e=this.authService.getToken();if(!e)return[];try{let s=JSON.parse(atob(e.split(".")[1]));return s.permission||s.permissions||[]}catch{return[]}}hasPermission(e,s){let t=`Permissions.${s}.${e}`;if(this.permissionCache.has(t))return this.permissionCache.get(t);let c=this._userPermissions().includes(t);return this.permissionCache.set(t,c),c}hasAnyPermission(e){return e.some(s=>this.hasPermission(s.action,s.resource))}hasAllPermissions(e){return e.every(s=>this.hasPermission(s.action,s.resource))}canView(e){return this.hasPermission(i.View,e)}canCreate(e){return this.hasPermission(i.Create,e)}canUpdate(e){return this.hasPermission(i.Update,e)}canDelete(e){return this.hasPermission(i.Delete,e)}canExport(e){return this.hasPermission(i.Export,e)}clearPermissions(){this._userPermissions.set([]),this.permissionCache.clear()}getAllAvailablePermissions(){return A()}getRolePermissions(e){return this.http.get(`${n.apiUrl}/roles/${e}/permissions`)}updateRolePermissions(e,s){return this.http.put(`${n.apiUrl}/roles/${e}/permissions`,{roleId:e,permissions:s})}static \u0275fac=function(s){return new(s||r)};static \u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();export{d as a,i as b,x as c,A as d,v as e,D as f};

import{a as Ge}from"./chunk-XILEJOTT.js";import{a as w,c as Ue,f as je}from"./chunk-SGCXT6IT.js";import"./chunk-4IQRVVSS.js";import{a as Pe,b as Ve,c as ke,d as Fe,e as Oe}from"./chunk-KYECD3ND.js";import{a as xe,b as he,c as Re,d as Se,e as Me,f as ve,g as be,h as we,i as ye,j as De,k as Ee,l as Te}from"./chunk-JDCNVKL3.js";import{c as Le,d as ze,e as He,f as Qe,g as Ae,h as $e,i as Be}from"./chunk-ZPZARE4P.js";import{b as Ie,c as Ne}from"./chunk-IMNAVXVZ.js";import{a as qe}from"./chunk-MEZ4YZNT.js";import{b as me}from"./chunk-XN4KGKLA.js";import{a as G,b as J,c as K,d as W}from"./chunk-HHGQWT7L.js";import"./chunk-R6QGXIMR.js";import{a as Ce}from"./chunk-XZK5SHMD.js";import{b as se,c as ce,e as de,f as pe,i as ue,j as fe,k as _e,l as ge}from"./chunk-FCCRYPII.js";import{a as X,b as Y}from"./chunk-LSYIZ5ZS.js";import{b as Z,d as ee,g as te,h as ie,k as ne,m as oe,n as ae,o as le,q as re}from"./chunk-BLGZ2ZXV.js";import{a as $,b as B}from"./chunk-36HQY7RT.js";import"./chunk-7FXRJWRW.js";import"./chunk-OEMMV5VK.js";import{a as q,c as U,d as j}from"./chunk-U2EMCCYP.js";import{d as Q,h as A}from"./chunk-VLA6YYWX.js";import"./chunk-NW6BZQUB.js";import"./chunk-CARY4E7O.js";import{Bb as i,Cb as n,Db as g,Eb as v,Fb as b,Hb as h,Kb as C,Mb as c,Qb as V,Rb as k,Sb as F,Sc as H,Vb as O,Wa as r,Wb as l,Xb as y,Yb as E,cc as I,dc as N,ea as R,ec as L,fb as x,ia as T,jc as z,mb as s,qa as u,qb as P,ra as f,rb as _,wb as d,xc as S}from"./chunk-ENBBOSSX.js";import"./chunk-4CLCTAJ7.js";var Je=["roleDialog"],Ke=()=>[5,10,25,50],We=t=>["/identity/roles",t,"permissions"];function Xe(t,m){if(t&1){let e=h();i(0,"button",27),C("click",function(){u(e);let a=c();return f(a.clearSearch())}),i(1,"mat-icon"),l(2,"close"),n()()}}function Ye(t,m){if(t&1){let e=h();i(0,"button",28),C("click",function(){u(e);let a=c();return f(a.openRoleDialog())}),i(1,"mat-icon"),l(2,"add"),n(),l(3," Add Role "),n()}}function Ze(t,m){t&1&&(i(0,"div",14),g(1,"mat-spinner",29),n())}function et(t,m){t&1&&(i(0,"th",30),l(1,"ID"),n())}function tt(t,m){if(t&1&&(i(0,"td",31)(1,"code",32),l(2),n()()),t&2){let e=m.$implicit;r(2),y(e.id)}}function it(t,m){t&1&&(i(0,"th",30),l(1,"Name"),n())}function nt(t,m){t&1&&(i(0,"span",34),l(1,"Default"),n())}function ot(t,m){if(t&1&&(i(0,"td",31)(1,"div",33),l(2),s(3,nt,2,0,"span",34),n()()),t&2){let e=m.$implicit,o=c();r(2),E(" ",e.name," "),r(),d(o.isDefaultRole(e.name)?3:-1)}}function at(t,m){t&1&&(i(0,"th",30),l(1,"Description"),n())}function lt(t,m){if(t&1&&(i(0,"td",31),l(1),n()),t&2){let e=m.$implicit;r(),y(e.description||"-")}}function rt(t,m){t&1&&g(0,"th",35)}function mt(t,m){if(t&1&&(i(0,"button",37)(1,"mat-icon"),l(2,"security"),n(),i(3,"span"),l(4,"Manage Permissions"),n()()),t&2){let e=c().$implicit;_("routerLink",L(1,We,e.id))}}function st(t,m){if(t&1){let e=h();i(0,"button",39),C("click",function(){u(e);let a=c().$implicit,p=c();return f(p.openRoleDialog(a))}),i(1,"mat-icon"),l(2,"edit"),n(),i(3,"span"),l(4,"Edit"),n()()}}function ct(t,m){if(t&1){let e=h();g(0,"mat-divider"),i(1,"button",40),C("click",function(){u(e);let a=c().$implicit,p=c();return f(p.deleteRole(a))}),i(2,"mat-icon"),l(3,"delete"),n(),i(4,"span"),l(5,"Delete"),n()()}}function dt(t,m){if(t&1&&(i(0,"td",31)(1,"button",36)(2,"mat-icon"),l(3,"more_vert"),n()(),i(4,"mat-menu",null,1),s(6,mt,5,3,"button",37)(7,st,5,0,"button",38)(8,ct,6,0),n()()),t&2){let e=m.$implicit,o=O(5),a=c();r(),_("matMenuTriggerFor",o),r(5),d(a.canViewPermissions()?6:-1),r(),d(a.canUpdate()&&!a.isDefaultRole(e.name)?7:-1),r(),d(a.canDelete()&&!a.isDefaultRole(e.name)?8:-1)}}function pt(t,m){t&1&&g(0,"tr",41)}function ut(t,m){t&1&&g(0,"tr",42)}function ft(t,m){if(t&1){let e=h();i(0,"button",47),C("click",function(){u(e);let a=c(2);return f(a.clearSearch())}),l(1,"Clear search"),n()}}function _t(t,m){if(t&1&&(i(0,"tr",43)(1,"td",44)(2,"div",45)(3,"mat-icon"),l(4,"search_off"),n(),i(5,"p"),l(6,"No roles found"),n(),s(7,ft,2,0,"button",46),n()()()),t&2){let e=c();r(),P("colspan",e.displayedColumns.length),r(6),d(e.searchQuery()?7:-1)}}function gt(t,m){if(t&1&&(i(0,"mat-form-field",50)(1,"mat-label"),l(2,"Role ID"),n(),g(3,"input",57),n()),t&2){let e,o=c(2);r(3),_("value",(e=o.editingRole())==null?null:e.id)}}function Ct(t,m){t&1&&(i(0,"mat-error"),l(1,"Role name is required"),n())}function xt(t,m){t&1&&g(0,"mat-spinner",56)}function ht(t,m){if(t&1){let e=h();i(0,"h2",48),l(1),n(),i(2,"mat-dialog-content")(3,"form",49),s(4,gt,4,1,"mat-form-field",50),i(5,"mat-form-field",50)(6,"mat-label"),l(7,"Role Name"),n(),g(8,"input",51),s(9,Ct,2,0,"mat-error"),n(),i(10,"mat-form-field",50)(11,"mat-label"),l(12,"Description"),n(),g(13,"textarea",52),n()()(),i(14,"mat-dialog-actions",53)(15,"button",54),l(16,"Cancel"),n(),i(17,"button",55),C("click",function(){u(e);let a=c();return f(a.saveRole())}),s(18,xt,1,0,"mat-spinner",56),l(19),n()()}if(t&2){let e,o=c();r(),y(o.editingRole()?"Edit Role":"Add New Role"),r(2),_("formGroup",o.roleForm),r(),d(o.editingRole()?4:-1),r(5),d((e=o.roleForm.get("name"))!=null&&e.hasError("required")?9:-1),r(8),_("disabled",o.roleForm.invalid||o.isSaving()),r(),d(o.isSaving()?18:-1),r(),E(" ",o.editingRole()?"Update":"Create"," ")}}var oi=(()=>{class t{roleDialogTemplate;fb=R(le);dialog=R(Le);notification=R(qe);roleService=R(Ge);permissionService=R(je);roles=x([]);isLoading=x(!1);isSaving=x(!1);searchQuery=x("");editingRole=x(null);pageIndex=x(0);pageSize=x(10);totalRoles=x(0);displayedColumns=["id","name","description","actions"];roleForm=this.fb.group({id:[""],name:["",ee.required],description:[""]});canCreate=S(()=>this.permissionService.canCreate(w.Roles));canUpdate=S(()=>this.permissionService.canUpdate(w.Roles));canDelete=S(()=>this.permissionService.canDelete(w.Roles));canViewPermissions=S(()=>this.permissionService.canView(w.RoleClaims));filteredRoles=S(()=>{let e=this.searchQuery().toLowerCase();return e?this.roles().filter(o=>o.name?.toLowerCase().includes(e)||o.description?.toLowerCase().includes(e)):this.roles()});isDefaultRole=Ue;ngOnInit(){this.loadRoles()}loadRoles(){this.isLoading.set(!0),this.roleService.getRoles().subscribe({next:e=>{this.roles.set(e),this.totalRoles.set(e.length),this.isLoading.set(!1)},error:()=>{this.notification.error("Failed to load roles"),this.isLoading.set(!1),this.loadMockData()}})}loadMockData(){let e=[{id:"1",name:"Admin",description:"Full administrative access to the system"},{id:"2",name:"Basic",description:"Basic user access"},{id:"3",name:"Manager",description:"Management level access"},{id:"4",name:"Accountant",description:"Access to accounting features"},{id:"5",name:"HR Manager",description:"Human resources management access"}];this.roles.set(e),this.totalRoles.set(e.length)}refreshRoles(){this.loadRoles()}onSearch(e){let o=e.target.value;this.searchQuery.set(o)}clearSearch(){this.searchQuery.set("")}onSort(e){console.log("Sort:",e)}onPageChange(e){this.pageIndex.set(e.pageIndex),this.pageSize.set(e.pageSize)}openRoleDialog(e){this.editingRole.set(e||null),e?this.roleForm.patchValue({id:e.id,name:e.name,description:e.description||""}):this.roleForm.reset(),this.dialog.open(this.roleDialogTemplate,{width:"500px"})}saveRole(){if(this.roleForm.invalid)return;this.isSaving.set(!0);let e={id:this.editingRole()?.id,name:this.roleForm.value.name,description:this.roleForm.value.description};this.roleService.createOrUpdateRole(e).subscribe({next:()=>{this.notification.success(this.editingRole()?"Role updated successfully":"Role created successfully"),this.dialog.closeAll(),this.loadRoles(),this.isSaving.set(!1)},error:o=>{this.notification.error(o?.error?.message||"Failed to save role"),this.isSaving.set(!1)}})}deleteRole(e){this.dialog.open(Be,{data:{title:"Delete Role",message:`Are you sure you want to delete the role "${e.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel"}}).afterClosed().subscribe(a=>{a&&this.roleService.deleteRole(e.id).subscribe({next:()=>{this.notification.success("Role deleted successfully"),this.loadRoles()},error:()=>{this.notification.error("Failed to delete role")}})})}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=T({type:t,selectors:[["app-roles"]],viewQuery:function(o,a){if(o&1&&V(Je,5),o&2){let p;k(p=F())&&(a.roleDialogTemplate=p.first)}},standalone:!0,features:[I],decls:38,vars:12,consts:[["roleDialog",""],["menu","matMenu"],[1,"roles-container"],["title","Roles","subtitle","Manage system roles and permissions","icon","admin_panel_settings"],[1,"toolbar"],[1,"search-container"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Search by name or description...",3,"input","value"],["matPrefix",""],["matSuffix","","mat-icon-button",""],[1,"actions"],["mat-stroked-button","",3,"click"],["mat-raised-button","","color","primary"],[1,"table-container"],[1,"loading-overlay"],["mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","description"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions","pageIndex"],["matSuffix","","mat-icon-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["diameter","48"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"role-id"],[1,"role-name"],[1,"default-badge"],["mat-header-cell",""],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"routerLink"],["mat-menu-item",""],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"delete-action",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell","no-data-cell"],[1,"no-data"],["mat-button","","color","primary"],["mat-button","","color","primary",3,"click"],["mat-dialog-title",""],[1,"role-form",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","placeholder","Enter role name"],["matInput","","formControlName","description","placeholder","Enter description","rows","3"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","20"],["matInput","","readonly","","disabled","",3,"value"]],template:function(o,a){if(o&1){let p=h();i(0,"div",2),g(1,"app-page-header",3),i(2,"div",4)(3,"div",5)(4,"mat-form-field",6)(5,"mat-label"),l(6,"Search roles"),n(),i(7,"input",7),C("input",function(M){return u(p),f(a.onSearch(M))}),n(),i(8,"mat-icon",8),l(9,"search"),n(),s(10,Xe,3,0,"button",9),n()(),i(11,"div",10)(12,"button",11),C("click",function(){return u(p),f(a.refreshRoles())}),i(13,"mat-icon"),l(14,"refresh"),n(),l(15," Refresh "),n(),s(16,Ye,4,0,"button",12),n()(),i(17,"div",13),s(18,Ze,2,0,"div",14),i(19,"table",15),C("matSortChange",function(M){return u(p),f(a.onSort(M))}),v(20,16),s(21,et,2,0,"th",17)(22,tt,3,1,"td",18),b(),v(23,19),s(24,it,2,0,"th",17)(25,ot,4,2,"td",18),b(),v(26,20),s(27,at,2,0,"th",17)(28,lt,2,1,"td",18),b(),v(29,21),s(30,rt,1,0,"th",22)(31,dt,9,4,"td",18),b(),s(32,pt,1,0,"tr",23)(33,ut,1,0,"tr",24)(34,_t,8,2,"tr",25),n(),i(35,"mat-paginator",26),C("page",function(M){return u(p),f(a.onPageChange(M))}),n()()(),s(36,ht,20,7,"ng-template",null,0,z)}o&2&&(r(7),_("value",a.searchQuery()),r(3),d(a.searchQuery()?10:-1),r(6),d(a.canCreate()?16:-1),r(2),d(a.isLoading()?18:-1),r(),_("dataSource",a.filteredRoles()),r(13),_("matHeaderRowDef",a.displayedColumns),r(),_("matRowDefColumns",a.displayedColumns),r(2),_("length",a.totalRoles())("pageSize",a.pageSize())("pageSizeOptions",N(11,Ke))("pageIndex",a.pageIndex()))},dependencies:[H,A,Q,re,ne,Z,te,ie,oe,ae,Te,xe,Re,be,Se,he,we,Me,ve,ye,De,Ee,Ve,Pe,Oe,ke,Fe,j,q,U,B,$,fe,ue,se,ce,de,pe,Ne,Ie,$e,ze,He,Ae,Qe,ge,_e,W,J,G,K,me,Y,X,Ce],styles:[".roles-container[_ngcontent-%COMP%]{padding:24px}.toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;gap:16px;flex-wrap:wrap}.search-container[_ngcontent-%COMP%]{flex:1;min-width:250px;max-width:400px}.search-field[_ngcontent-%COMP%]{width:100%}.actions[_ngcontent-%COMP%]{display:flex;gap:12px}.table-container[_ngcontent-%COMP%]{position:relative;background:var(--surface-color);border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #0000001a}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:#fffc;z-index:10}table[_ngcontent-%COMP%]{width:100%}.role-id[_ngcontent-%COMP%]{font-family:monospace;background:#0000000d;padding:4px 8px;border-radius:4px;font-size:12px}.role-name[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:500}.default-badge[_ngcontent-%COMP%]{font-size:10px;background:#dbeafe;color:#1e40af;padding:2px 6px;border-radius:4px;font-weight:500}.delete-action[_ngcontent-%COMP%]{color:#dc2626}.no-data-cell[_ngcontent-%COMP%]{text-align:center;padding:48px!important}.no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:8px;color:var(--text-secondary)}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}.role-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;min-width:400px}.full-width[_ngcontent-%COMP%]{width:100%}@media (max-width: 600px){.toolbar[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.search-container[_ngcontent-%COMP%]{max-width:none}.actions[_ngcontent-%COMP%]{justify-content:flex-end}.role-form[_ngcontent-%COMP%]{min-width:auto}}"]})}return t})();export{oi as RolesComponent};
